<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>数据分析 - AI客户管理系统</title>
    <link href="/lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/lib/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="page-title">
                <i class="bi bi-bar-chart"></i> 数据分析
            </div>
            <a href="/" class="back-home-btn">
                <i class="bi bi-house-fill"></i> 返回首页
            </a>
        </div>
        
        <!-- 关键指标 -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">2,456</div>
                    <div class="stats-label">总客户数</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">156</div>
                    <div class="stats-label">新增客户</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">89%</div>
                    <div class="metric-label">客户满意度</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number">92%</div>
                    <div class="stats-label">转化率</div>
                </div>
            </div>
        </div>

        <!-- 数据筛选 -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-3"><i class="bi bi-funnel"></i> 数据筛选</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">时间范围</label>
                            <select class="form-select" id="timeRange">
                                <option value="7">最近7天</option>
                                <option value="30" selected>最近30天</option>
                                <option value="90">最近90天</option>
                                <option value="365">最近一年</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">客户类型</label>
                            <select class="form-select" id="customerType">
                                <option value="all">全部类型</option>
                                <option value="individual">个人客户</option>
                                <option value="enterprise">企业客户</option>
                                <option value="research">科研院所</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="mb-3">
                            <label class="form-label">地区</label>
                            <select class="form-select" id="region">
                                <option value="all">全部地区</option>
                                <option value="beijing">北京</option>
                                <option value="shanghai">上海</option>
                                <option value="guangdong">广东</option>
                                <option value="jiangsu">江苏</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button class="btn btn-primary w-100" onclick="applyFilters()">
                            <i class="bi bi-search"></i> 应用筛选
                        </button>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-3">
                        <button class="btn btn-outline-secondary" onclick="resetFilters()">
                            <i class="bi bi-arrow-clockwise"></i> 重置筛选
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 图表展示 -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-3"><i class="bi bi-graph-up"></i> 客户增长趋势</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="customerGrowthChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-3"><i class="bi bi-pie-chart"></i> 客户类型分布</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="customerTypeChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-3"><i class="bi bi-heart"></i> 满意度趋势</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="satisfactionChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-3"><i class="bi bi-geo-alt"></i> 地区分布</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="regionChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 数据表格 -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">详细数据</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>客户名称</th>
                                <th>客户类型</th>
                                <th>地区</th>
                                <th>注册时间</th>
                                <th>最后活跃</th>
                                <th>满意度</th>
                                <th>状态</th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- 数据将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/lib/bootstrap/bootstrap.bundle.min.js"></script>
    <script>
        // 模拟数据
        let mockData = [
            {
                customerName: '张三',
                customerType: '个人客户',
                region: '北京',
                registerTime: '2024-01-15',
                lastActive: '2024-01-25',
                satisfaction: 92,
                status: '活跃'
            },
            {
                customerName: '李四农业科技有限公司',
                customerType: '企业客户',
                region: '上海',
                registerTime: '2024-01-10',
                lastActive: '2024-01-24',
                satisfaction: 88,
                status: '活跃'
            },
            {
                customerName: '王五种子研究所',
                customerType: '科研院所',
                region: '广东',
                registerTime: '2024-01-05',
                lastActive: '2024-01-23',
                satisfaction: 95,
                status: '活跃'
            },
            {
                customerName: '赵六农业合作社',
                customerType: '企业客户',
                region: '江苏',
                registerTime: '2024-01-01',
                lastActive: '2024-01-22',
                satisfaction: 85,
                status: '活跃'
            },
            {
                customerName: '孙七种子公司',
                customerType: '企业客户',
                region: '北京',
                registerTime: '2023-12-28',
                lastActive: '2024-01-21',
                satisfaction: 90,
                status: '活跃'
            }
        ];

        let currentFilters = {
            timeRange: '30',
            customerType: 'all',
            region: 'all'
        };

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadCharts();
            loadDataTable();
        });

        // 加载图表
        function loadCharts() {
            loadCustomerGrowthChart();
            loadCustomerTypeChart();
            loadSatisfactionChart();
            loadRegionChart();
        }

        // 客户增长趋势图
        function loadCustomerGrowthChart() {
            const ctx = document.getElementById('customerGrowthChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                    datasets: [{
                        label: '客户数量',
                        data: [1200, 1350, 1500, 1650, 1800, 2000],
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '客户增长趋势'
                        }
                    }
                }
            });
        }

        // 客户类型分布图
        function loadCustomerTypeChart() {
            const ctx = document.getElementById('customerTypeChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['个人客户', '企业客户', '科研院所'],
                    datasets: [{
                        data: [30, 50, 20],
                        backgroundColor: [
                            'rgb(255, 99, 132)',
                            'rgb(54, 162, 235)',
                            'rgb(255, 205, 86)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '客户类型分布'
                        }
                    }
                }
            });
        }

        // 满意度趋势图
        function loadSatisfactionChart() {
            const ctx = document.getElementById('satisfactionChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月'],
                    datasets: [{
                        label: '满意度(%)',
                        data: [85, 87, 89, 88, 90, 92],
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgb(54, 162, 235)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '满意度趋势'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // 地区分布图
        function loadRegionChart() {
            const ctx = document.getElementById('regionChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['北京', '上海', '广东', '江苏', '其他'],
                    datasets: [{
                        label: '客户数量',
                        data: [500, 400, 350, 300, 250],
                        backgroundColor: 'rgba(255, 99, 132, 0.5)',
                        borderColor: 'rgb(255, 99, 132)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '地区分布'
                        }
                    }
                }
            });
        }

        // 加载数据表格
        function loadDataTable() {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';

            let filteredData = mockData;
            
            // 应用筛选条件
            if (currentFilters.customerType !== 'all') {
                filteredData = filteredData.filter(item => {
                    switch (currentFilters.customerType) {
                        case 'individual':
                            return item.customerType === '个人客户';
                        case 'enterprise':
                            return item.customerType === '企业客户';
                        case 'research':
                            return item.customerType === '科研院所';
                        default:
                            return true;
                    }
                });
            }
            
            if (currentFilters.region !== 'all') {
                filteredData = filteredData.filter(item => {
                    switch (currentFilters.region) {
                        case 'beijing':
                            return item.region === '北京';
                        case 'shanghai':
                            return item.region === '上海';
                        case 'guangdong':
                            return item.region === '广东';
                        case 'jiangsu':
                            return item.region === '江苏';
                        default:
                            return true;
                    }
                });
            }

            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="table-cell-truncate" title="${item.customerName}">${item.customerName}</td>
                    <td class="table-cell-truncate" title="${item.customerType}">${item.customerType}</td>
                    <td class="table-cell-truncate" title="${item.region}">${item.region}</td>
                    <td class="table-cell-truncate" title="${item.registerTime}">${item.registerTime}</td>
                    <td class="table-cell-truncate" title="${item.lastActive}">${item.lastActive}</td>
                    <td><span class="badge bg-success">${item.satisfaction}%</span></td>
                    <td><span class="badge bg-primary">${item.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // 应用筛选
        function applyFilters() {
            currentFilters.timeRange = document.getElementById('timeRange').value;
            currentFilters.customerType = document.getElementById('customerType').value;
            currentFilters.region = document.getElementById('region').value;
            
            loadDataTable();
            alert('筛选条件已应用！');
        }

        // 重置筛选
        function resetFilters() {
            document.getElementById('timeRange').value = '30';
            document.getElementById('customerType').value = 'all';
            document.getElementById('region').value = 'all';
            
            currentFilters = {
                timeRange: '30',
                customerType: 'all',
                region: 'all'
            };
            
            loadDataTable();
            alert('筛选条件已重置！');
        }
    </script>
</body>
</html>