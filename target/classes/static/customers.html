<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客户档案管理 - AI客户管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/ai-customer/css/common.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="page-title">
                <i class="bi bi-people-fill"></i> 客户档案管理
            </div>
            <a href="/ai-customer/" class="back-home-btn">
                <i class="bi bi-house-fill"></i> 返回首页
            </a>
        </div>
        
        <!-- 统计卡片 -->
        <div class="row mb-3">
            <div class="col-md-3">
                <div class="stats-card" style="padding: 1rem; min-height: 80px; display: flex; align-items: center; justify-content: center;">
                    <div>
                        <div class="stats-label" style="font-size: 0.9rem; margin-bottom: 0.25rem;">客户总数</div>
                        <div class="stats-number" style="font-size: 1.5rem; font-weight: bold;">1,234</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="padding: 1rem; min-height: 80px; display: flex; align-items: center; justify-content: center;">
                    <div>
                        <div class="stats-label" style="font-size: 0.9rem; margin-bottom: 0.25rem;">客户满意度</div>
                        <div class="stats-number" style="font-size: 1.5rem; font-weight: bold;">89%</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="padding: 1rem; min-height: 80px; display: flex; align-items: center; justify-content: center;">
                    <div>
                        <div class="stats-label" style="font-size: 0.9rem; margin-bottom: 0.25rem;">本月新增</div>
                        <div class="stats-number" style="font-size: 1.5rem; font-weight: bold;">156</div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card" style="padding: 1rem; min-height: 80px; display: flex; align-items: center; justify-content: center;">
                    <div>
                        <div class="stats-label" style="font-size: 0.9rem; margin-bottom: 0.25rem;">潜在客户</div>
                        <div class="stats-number" style="font-size: 1.5rem; font-weight: bold;">45</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 搜索和筛选区域 -->
        <div class="card mb-3">
            <div class="card-body">
                <!-- 第一排：搜索条件 -->
                <div class="row g-3 mb-3">
                    <div class="col-md-3">
                        <label class="form-label">客户名称</label>
                        <input type="text" class="form-control" id="customerName" placeholder="请输入客户名称...">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">客户类型</label>
                        <select class="form-select" id="customerType">
                            <option value="">全部</option>
                            <option value="个人">个人</option>
                            <option value="企业">企业</option>
                            <option value="科研院所">科研院所</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">申请性质</label>
                        <select class="form-select" id="applicationType">
                            <option value="">全部</option>
                            <option value="新品种保护">新品种保护</option>
                            <option value="品种审定">品种审定</option>
                            <option value="商标注册">商标注册</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label">地区</label>
                        <select class="form-select" id="region">
                            <option value="">全部</option>
                            <option value="北京">北京</option>
                            <option value="上海">上海</option>
                            <option value="广东">广东</option>
                            <option value="江苏">江苏</option>
                        </select>
                    </div>
                </div>
                
                <!-- 第二排：操作按钮 -->
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex flex-wrap gap-2 justify-content-between">
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-success" onclick="showAddCustomerModal()">
                                    <i class="bi bi-plus"></i> 新增
                                </button>
                                <button class="btn btn-info" onclick="showBatchImport()">
                                    <i class="bi bi-upload"></i> 批量导入
                                </button>
                                <button class="btn btn-warning" onclick="exportCustomers()">
                                    <i class="bi bi-download"></i> 导出数据
                                </button>
                                <button class="btn btn-danger" onclick="batchDelete()">
                                    <i class="bi bi-trash"></i> 批量删除
                                </button>
                            </div>
                            <div class="d-flex flex-wrap gap-2">
                                <button class="btn btn-primary" onclick="searchCustomers()">
                                    <i class="bi bi-search"></i> 搜索
                                </button>
                                <button class="btn btn-secondary" onclick="resetFilters()">
                                    <i class="bi bi-arrow-clockwise"></i> 重置
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 记录统计信息 - 移到右下角 -->
        <div class="position-fixed" style="bottom: 20px; right: 20px; z-index: 1000;">
            <span class="badge bg-secondary fs-6">共 <span id="totalCustomers">0</span> 条记录</span>
        </div>

        <!-- 客户列表 -->
        <div class="card">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th>客户名称</th>
                                <th>联系人</th>
                                <th>电话</th>
                                <th>客户类型</th>
                                <th>申请性质</th>
                                <th>地区</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="customerTableBody">
                            <!-- 客户数据将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增/编辑客户模态框 -->
    <div class="modal fade" id="customerModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerModalTitle">新增客户</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <input type="hidden" id="customerId" name="id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">客户名称 *</label>
                                    <input type="text" class="form-control" id="customerNameInput" name="customerName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">联系人 *</label>
                                    <input type="text" class="form-control" id="contactPerson" name="contactPerson" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">电话 *</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">邮箱</label>
                                    <input type="email" class="form-control" id="email" name="email">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">客户类型 *</label>
                                    <select class="form-select" id="customerTypeSelect" name="customerType" required>
                                        <option value="">请选择</option>
                                        <option value="个人">个人</option>
                                        <option value="企业">企业</option>
                                        <option value="科研院所">科研院所</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">地区 *</label>
                                    <select class="form-select" id="regionSelect" name="region" required>
                                        <option value="">请选择</option>
                                        <option value="北京">北京</option>
                                        <option value="上海">上海</option>
                                        <option value="广东">广东</option>
                                        <option value="江苏">江苏</option>
                                        <option value="浙江">浙江</option>
                                        <option value="山东">山东</option>
                                        <option value="河南">河南</option>
                                        <option value="四川">四川</option>
                                        <option value="湖北">湖北</option>
                                        <option value="湖南">湖南</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">申请性质 *</label>
                                    <select class="form-select" id="applicationTypeSelect" name="applicationType" required>
                                        <option value="">请选择</option>
                                        <option value="新品种保护">新品种保护</option>
                                        <option value="品种审定">品种审定</option>
                                        <option value="商标注册">商标注册</option>
                                        <option value="专利保护">专利保护</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">公司规模</label>
                                    <select class="form-select" id="companySize" name="companySize">
                                        <option value="">请选择</option>
                                        <option value="小型企业">小型企业</option>
                                        <option value="中型企业">中型企业</option>
                                        <option value="大型企业">大型企业</option>
                                        <option value="上市公司">上市公司</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">行业</label>
                                    <select class="form-select" id="industry" name="industry">
                                        <option value="">请选择</option>
                                        <option value="农业">农业</option>
                                        <option value="种业">种业</option>
                                        <option value="生物技术">生物技术</option>
                                        <option value="科研院所">科研院所</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">年营业额</label>
                                    <select class="form-select" id="annualRevenue" name="annualRevenue">
                                        <option value="">请选择</option>
                                        <option value="100万以下">100万以下</option>
                                        <option value="100-500万">100-500万</option>
                                        <option value="500-1000万">500-1000万</option>
                                        <option value="1000万以上">1000万以上</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 植物新品种保护申请信息 -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">植物新品种保护申请信息</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">品种名称</label>
                                            <input type="text" class="form-control" id="varietyName" name="varietyName">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">品种类型</label>
                                            <select class="form-select" id="varietyType" name="varietyType">
                                                <option value="">请选择</option>
                                                <option value="玉米">玉米</option>
                                                <option value="水稻">水稻</option>
                                                <option value="小麦">小麦</option>
                                                <option value="大豆">大豆</option>
                                                <option value="其他">其他</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">申请号</label>
                                            <input type="text" class="form-control" id="applicationNumber" name="applicationNumber">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">申请日期</label>
                                            <input type="date" class="form-control" id="applicationDate" name="applicationDate">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 培育人信息 -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">培育人信息</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">培育人姓名</label>
                                            <input type="text" class="form-control" id="breederName" name="breederName">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">培育人单位</label>
                                            <input type="text" class="form-control" id="breederUnit" name="breederUnit">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">培育人地址</label>
                                            <input type="text" class="form-control" id="breederAddress" name="breederAddress">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">培育人电话</label>
                                            <input type="text" class="form-control" id="breederPhone" name="breederPhone">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 申请人信息 -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">申请人信息</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">申请人姓名</label>
                                            <input type="text" class="form-control" id="applicantName" name="applicantName">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">申请人单位</label>
                                            <input type="text" class="form-control" id="applicantUnit" name="applicantUnit">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">申请人地址</label>
                                            <input type="text" class="form-control" id="applicantAddress" name="applicantAddress">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="mb-3">
                                            <label class="form-label">申请人电话</label>
                                            <input type="text" class="form-control" id="applicantPhone" name="applicantPhone">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 其他信息 -->
                        <div class="card mt-3">
                            <div class="card-header">
                                <h6 class="mb-0">其他信息</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">品种描述</label>
                                            <textarea class="form-control" id="varietyDescription" name="varietyDescription" rows="4"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">技术特点</label>
                                            <textarea class="form-control" id="technicalFeatures" name="technicalFeatures" rows="4"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">市场前景</label>
                                            <textarea class="form-control" id="marketProspect" name="marketProspect" rows="4"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">详细地址</label>
                            <textarea class="form-control" id="address" name="address" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">备注</label>
                            <textarea class="form-control" id="remarks" name="remarks" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveCustomer()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 客户详情模态框 -->
    <div class="modal fade" id="customerDetailModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">客户详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="customerDetailContent">
                    <!-- 客户详情内容将通过JavaScript动态加载 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 批量导入模态框 -->
    <div class="modal fade" id="batchImportModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">批量导入客户信息</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <h6><i class="bi bi-info-circle"></i> 使用说明：</h6>
                        <ul class="mb-0">
                            <li>支持从Excel、Word等文档中复制数据直接粘贴</li>
                            <li>每行一个客户，字段用制表符或逗号分隔</li>
                            <li>必填字段：客户名称、联系人、电话、客户类型、申请性质、地区</li>
                            <li>系统会自动识别和整理数据格式</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">数据格式示例：</label>
                        <div class="bg-light p-3 rounded">
                            <code>
                                张三公司 | 李四 | 13800138000 | 企业客户 | 新品种申请 | 北京 | 农业 | 1000万<br>
                                王五农场 | 赵六 | 13900139000 | 个人客户 | 品种权申请 | 上海 | 种植业 | 500万
                            </code>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">粘贴客户数据：</label>
                        <textarea class="form-control" id="batchImportData" rows="10" 
                                  placeholder="请在此处粘贴客户数据，每行一个客户，字段用制表符或逗号分隔..."></textarea>
                    </div>

                    <div class="mb-3">
                        <button class="btn btn-outline-primary" onclick="parseImportData()">
                            <i class="bi bi-gear"></i> 解析数据
                        </button>
                        <button class="btn btn-outline-secondary ms-2" onclick="clearImportData()">
                            <i class="bi bi-trash"></i> 清空
                        </button>
                    </div>

                    <div id="importPreview" style="display: none;">
                        <h6>数据预览：</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>客户名称</th>
                                        <th>联系人</th>
                                        <th>电话</th>
                                        <th>客户类型</th>
                                        <th>申请性质</th>
                                        <th>地区</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody id="importPreviewBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveBatchImport()" id="saveImportBtn" disabled>
                        <i class="bi bi-save"></i> 保存到数据库
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 模拟客户数据
        let customers = [
            {
                id: 1,
                customerName: '张三',
                contactPerson: '张三',
                phone: '13612345678',
                email: 'zhangsan@example.com',
                customerType: '个人',
                applicationType: '新品种保护',
                region: '北京',
                companySize: '',
                address: '北京市朝阳区',
                remarks: '种子培育专家',
                createTime: '2024-01-15'
            },
            {
                id: 2,
                customerName: '李四农业科技有限公司',
                contactPerson: '李四',
                phone: '13987654321',
                email: 'lisi@company.com',
                customerType: '企业',
                applicationType: '品种审定',
                region: '上海',
                companySize: '中型企业',
                address: '上海市浦东新区',
                remarks: '专业从事水稻育种',
                createTime: '2024-01-20'
            },
            {
                id: 3,
                customerName: '王五种子研究所',
                contactPerson: '王五',
                phone: '13888888888',
                email: 'wangwu@institute.com',
                customerType: '科研院所',
                applicationType: '专利保护',
                region: '广东',
                companySize: '',
                address: '广东省广州市',
                remarks: '国家级种子研究机构',
                createTime: '2024-01-25'
            }
        ];

        let selectedCustomers = [];

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadCustomers();
        });

        // 加载客户列表
        function loadCustomers() {
            const tbody = document.getElementById('customerTableBody');
            tbody.innerHTML = '';

            customers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = 
                    '<td>' +
                        '<input type="checkbox" class="customer-checkbox" value="' + customer.id + '" onchange="toggleCustomerSelection(' + customer.id + ')">' +
                    '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.customerName + '">' + customer.customerName + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.contactPerson + '">' + customer.contactPerson + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.phone + '">' + customer.phone + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.customerType + '">' + customer.customerType + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.applicationType + '">' + customer.applicationType + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.region + '">' + customer.region + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.createTime + '">' + customer.createTime + '</td>' +
                    '<td>' +
                        '<button class="btn btn-sm btn-outline-primary me-1" onclick="viewCustomer(' + customer.id + ')">' +
                            '<i class="bi bi-eye"></i> 详情' +
                        '</button>' +
                        '<button class="btn btn-sm btn-outline-warning me-1" onclick="editCustomer(' + customer.id + ')">' +
                            '<i class="bi bi-pencil"></i> 编辑' +
                        '</button>' +
                        '<button class="btn btn-sm btn-outline-danger" onclick="deleteCustomer(' + customer.id + ')">' +
                            '<i class="bi bi-trash"></i> 删除' +
                        '</button>' +
                    '</td>';
                tbody.appendChild(row);
            });
        }

        // 搜索客户
        function searchCustomers() {
            const name = document.getElementById('customerName').value;
            const type = document.getElementById('customerType').value;
            const application = document.getElementById('applicationType').value;
            const region = document.getElementById('region').value;

            let filteredCustomers = customers.filter(customer => {
                return (!name || customer.customerName.includes(name)) &&
                       (!type || customer.customerType === type) &&
                       (!application || customer.applicationType === application) &&
                       (!region || customer.region === region);
            });

            // 重新渲染表格
            const tbody = document.getElementById('customerTableBody');
            tbody.innerHTML = '';

            filteredCustomers.forEach(customer => {
                const row = document.createElement('tr');
                row.innerHTML = 
                    '<td>' +
                        '<input type="checkbox" class="customer-checkbox" value="' + customer.id + '" onchange="toggleCustomerSelection(' + customer.id + ')">' +
                    '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.customerName + '">' + customer.customerName + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.contactPerson + '">' + customer.contactPerson + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.phone + '">' + customer.phone + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.customerType + '">' + customer.customerType + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.applicationType + '">' + customer.applicationType + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.region + '">' + customer.region + '</td>' +
                    '<td class="table-cell-truncate" title="' + customer.createTime + '">' + customer.createTime + '</td>' +
                    '<td>' +
                        '<button class="btn btn-sm btn-outline-primary me-1" onclick="viewCustomer(' + customer.id + ')">' +
                            '<i class="bi bi-eye"></i> 详情' +
                        '</button>' +
                        '<button class="btn btn-sm btn-outline-warning me-1" onclick="editCustomer(' + customer.id + ')">' +
                            '<i class="bi bi-pencil"></i> 编辑' +
                        '</button>' +
                        '<button class="btn btn-sm btn-outline-danger" onclick="deleteCustomer(' + customer.id + ')">' +
                            '<i class="bi bi-trash"></i> 删除' +
                        '</button>' +
                    '</td>';
                tbody.appendChild(row);
            });
        }

        // 重置筛选条件
        function resetFilters() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerType').value = '';
            document.getElementById('applicationType').value = '';
            document.getElementById('region').value = '';
            loadCustomers();
        }

        // 显示新增客户模态框
        function showAddCustomerModal() {
            document.getElementById('customerModalTitle').textContent = '新增客户';
            document.getElementById('customerForm').reset();
            document.getElementById('customerId').value = '';
            new bootstrap.Modal(document.getElementById('customerModal')).show();
        }

        // 显示批量导入模态框
        function showBatchImport() {
            new bootstrap.Modal(document.getElementById('batchImportModal')).show();
        }

        // 解析导入数据
        function parseImportData() {
            const data = document.getElementById('batchImportData').value.trim();
            if (!data) {
                alert('请先粘贴要导入的数据！');
                return;
            }

            const lines = data.split('\n').filter(line => line.trim());
            const parsedData = [];
            let hasError = false;

            lines.forEach((line, index) => {
                const fields = line.split(/[\t,|]/).map(field => field.trim());
                
                if (fields.length < 6) {
                    hasError = true;
                    parsedData.push({
                        customerName: fields[0] || '',
                        contactPerson: fields[1] || '',
                        phone: fields[2] || '',
                        customerType: fields[3] || '',
                        applicationType: fields[4] || '',
                        region: fields[5] || '',
                        industry: fields[6] || '',
                        annualRevenue: fields[7] || '',
                        status: 'error',
                        error: '字段不足，至少需要6个字段'
                    });
                    return;
                }

                // 验证必填字段
                const requiredFields = [fields[0], fields[1], fields[2], fields[3], fields[4], fields[5]];
                const missingFields = requiredFields.some(field => !field);
                
                if (missingFields) {
                    hasError = true;
                    parsedData.push({
                        customerName: fields[0] || '',
                        contactPerson: fields[1] || '',
                        phone: fields[2] || '',
                        customerType: fields[3] || '',
                        applicationType: fields[4] || '',
                        region: fields[5] || '',
                        industry: fields[6] || '',
                        annualRevenue: fields[7] || '',
                        status: 'error',
                        error: '必填字段不能为空'
                    });
                } else {
                    parsedData.push({
                        customerName: fields[0],
                        contactPerson: fields[1],
                        phone: fields[2],
                        customerType: fields[3],
                        applicationType: fields[4],
                        region: fields[5],
                        industry: fields[6] || '',
                        annualRevenue: fields[7] || '',
                        varietyName: fields[8] || '',
                        varietyType: fields[9] || '',
                        applicationNumber: fields[10] || '',
                        applicationDate: fields[11] || '',
                        breederName: fields[12] || '',
                        breederUnit: fields[13] || '',
                        breederAddress: fields[14] || '',
                        breederPhone: fields[15] || '',
                        applicantName: fields[16] || '',
                        applicantUnit: fields[17] || '',
                        applicantAddress: fields[18] || '',
                        applicantPhone: fields[19] || '',
                        varietyDescription: fields[20] || '',
                        technicalFeatures: fields[21] || '',
                        marketProspect: fields[22] || '',
                        address: fields[23] || '',
                        remarks: fields[24] || '',
                        status: 'valid'
                    });
                }
            });

            // 显示预览
            displayImportPreview(parsedData);
            
            if (!hasError) {
                document.getElementById('saveImportBtn').disabled = false;
            }
        }

        // 显示导入预览
        function displayImportPreview(data) {
            const previewBody = document.getElementById('importPreviewBody');
            previewBody.innerHTML = '';

            data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.className = item.status === 'error' ? 'table-danger' : 'table-success';
                
                row.innerHTML = `
                    <td>${item.customerName}</td>
                    <td>${item.contactPerson}</td>
                    <td>${item.phone}</td>
                    <td>${item.customerType}</td>
                    <td>${item.applicationType}</td>
                    <td>${item.region}</td>
                    <td>
                        ${item.status === 'error' ? 
                            `<span class="text-danger"><i class="bi bi-exclamation-triangle"></i> ${item.error}</span>` : 
                            `<span class="text-success"><i class="bi bi-check-circle"></i> 有效</span>`
                        }
                    </td>
                `;
                previewBody.appendChild(row);
            });

            document.getElementById('importPreview').style.display = 'block';
        }

        // 清空导入数据
        function clearImportData() {
            document.getElementById('batchImportData').value = '';
            document.getElementById('importPreview').style.display = 'none';
            document.getElementById('saveImportBtn').disabled = true;
        }

        // 保存批量导入数据
        function saveBatchImport() {
            const data = document.getElementById('batchImportData').value.trim();
            if (!data) {
                alert('没有要保存的数据！');
                return;
            }

            const lines = data.split('\n').filter(line => line.trim());
            let successCount = 0;
            let errorCount = 0;

            lines.forEach((line, index) => {
                const fields = line.split(/[\t,|]/).map(field => field.trim());
                
                if (fields.length >= 6) {
                    const requiredFields = [fields[0], fields[1], fields[2], fields[3], fields[4], fields[5]];
                    const missingFields = requiredFields.some(field => !field);
                    
                    if (!missingFields) {
                        // 创建新客户对象
                        const newCustomer = {
                            id: Date.now() + index,
                            customerName: fields[0],
                            contactPerson: fields[1],
                            phone: fields[2],
                            email: fields[3] || '',
                            companySize: fields[4] || '',
                            customerType: fields[5],
                            applicationType: fields[6],
                            region: fields[7],
                            industry: fields[8] || '',
                            annualRevenue: fields[9] || '',
                            varietyName: fields[10] || '',
                            varietyType: fields[11] || '',
                            applicationNumber: fields[12] || '',
                            applicationDate: fields[13] || '',
                            breederName: fields[14] || '',
                            breederUnit: fields[15] || '',
                            breederAddress: fields[16] || '',
                            breederPhone: fields[17] || '',
                            applicantName: fields[18] || '',
                            applicantUnit: fields[19] || '',
                            applicantAddress: fields[20] || '',
                            applicantPhone: fields[21] || '',
                            varietyDescription: fields[22] || '',
                            technicalFeatures: fields[23] || '',
                            marketProspect: fields[24] || '',
                            address: fields[25] || '',
                            remarks: fields[26] || '',
                            createTime: new Date().toLocaleString(),
                            updateTime: new Date().toLocaleString()
                        };

                        customers.push(newCustomer);
                        successCount++;
                    } else {
                        errorCount++;
                    }
                } else {
                    errorCount++;
                }
            });

            // 刷新客户列表
            loadCustomers();
            
            // 关闭模态框
            bootstrap.Modal.getInstance(document.getElementById('batchImportModal')).hide();
            
            // 显示结果
            alert(`批量导入完成！\n成功导入：${successCount} 条\n失败：${errorCount} 条`);
            
            // 清空数据
            clearImportData();
        }

        // 查看客户详情
        function viewCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (customer) {
                const content = 
                    '<div class="row">' +
                        '<div class="col-md-4">' +
                            '<h6>基本信息</h6>' +
                            '<p><strong>客户名称：</strong>' + customer.customerName + '</p>' +
                            '<p><strong>联系人：</strong>' + customer.contactPerson + '</p>' +
                            '<p><strong>电话：</strong>' + customer.phone + '</p>' +
                            '<p><strong>邮箱：</strong>' + (customer.email || '未填写') + '</p>' +
                            '<p><strong>公司规模：</strong>' + (customer.companySize || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-4">' +
                            '<h6>业务信息</h6>' +
                            '<p><strong>客户类型：</strong>' + customer.customerType + '</p>' +
                            '<p><strong>申请性质：</strong>' + customer.applicationType + '</p>' +
                            '<p><strong>地区：</strong>' + customer.region + '</p>' +
                            '<p><strong>行业：</strong>' + (customer.industry || '未填写') + '</p>' +
                            '<p><strong>年营业额：</strong>' + (customer.annualRevenue || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-4">' +
                            '<h6>植物新品种保护申请信息</h6>' +
                            '<p><strong>品种名称：</strong>' + (customer.varietyName || '未填写') + '</p>' +
                            '<p><strong>品种类型：</strong>' + (customer.varietyType || '未填写') + '</p>' +
                            '<p><strong>申请号：</strong>' + (customer.applicationNumber || '未填写') + '</p>' +
                            '<p><strong>申请日期：</strong>' + (customer.applicationDate || '未填写') + '</p>' +
                        '</div>' +
                    '</div>' +
                    '<div class="row mt-3">' +
                        '<div class="col-md-4">' +
                            '<h6>培育人信息</h6>' +
                            '<p><strong>培育人姓名：</strong>' + (customer.breederName || '未填写') + '</p>' +
                            '<p><strong>培育人单位：</strong>' + (customer.breederUnit || '未填写') + '</p>' +
                            '<p><strong>培育人地址：</strong>' + (customer.breederAddress || '未填写') + '</p>' +
                            '<p><strong>培育人电话：</strong>' + (customer.breederPhone || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-4">' +
                            '<h6>申请人信息</h6>' +
                            '<p><strong>申请人姓名：</strong>' + (customer.applicantName || '未填写') + '</p>' +
                            '<p><strong>申请人单位：</strong>' + (customer.applicantUnit || '未填写') + '</p>' +
                            '<p><strong>申请人地址：</strong>' + (customer.applicantAddress || '未填写') + '</p>' +
                            '<p><strong>申请人电话：</strong>' + (customer.applicantPhone || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-4">' +
                            '<h6>系统信息</h6>' +
                            '<p><strong>创建时间：</strong>' + customer.createTime + '</p>' +
                            '<p><strong>最后更新：</strong>' + (customer.updateTime || customer.createTime) + '</p>' +
                        '</div>' +
                    '</div>' +
                    '<div class="row mt-3">' +
                        '<div class="col-md-4">' +
                            '<h6>品种描述</h6>' +
                            '<p>' + (customer.varietyDescription || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-4">' +
                            '<h6>技术特点</h6>' +
                            '<p>' + (customer.technicalFeatures || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-4">' +
                            '<h6>市场前景</h6>' +
                            '<p>' + (customer.marketProspect || '未填写') + '</p>' +
                        '</div>' +
                    '</div>' +
                    '<div class="row mt-3">' +
                        '<div class="col-md-6">' +
                            '<h6>地址信息</h6>' +
                            '<p><strong>详细地址：</strong>' + (customer.address || '未填写') + '</p>' +
                        '</div>' +
                        '<div class="col-md-6">' +
                            '<h6>备注信息</h6>' +
                            '<p><strong>备注：</strong>' + (customer.remarks || '无') + '</p>' +
                        '</div>' +
                    '</div>';
                document.getElementById('customerDetailContent').innerHTML = content;
                new bootstrap.Modal(document.getElementById('customerDetailModal')).show();
            }
        }

        // 编辑客户
        function editCustomer(id) {
            const customer = customers.find(c => c.id === id);
            if (customer) {
                document.getElementById('customerModalTitle').textContent = '编辑客户';
                document.getElementById('customerId').value = customer.id;
                document.getElementById('customerNameInput').value = customer.customerName;
                document.getElementById('contactPerson').value = customer.contactPerson;
                document.getElementById('phone').value = customer.phone;
                document.getElementById('email').value = customer.email || '';
                document.getElementById('customerTypeSelect').value = customer.customerType;
                document.getElementById('regionSelect').value = customer.region;
                document.getElementById('applicationTypeSelect').value = customer.applicationType;
                document.getElementById('companySize').value = customer.companySize || '';
                document.getElementById('industry').value = customer.industry || '';
                document.getElementById('annualRevenue').value = customer.annualRevenue || '';
                document.getElementById('varietyName').value = customer.varietyName || '';
                document.getElementById('varietyType').value = customer.varietyType || '';
                document.getElementById('applicationNumber').value = customer.applicationNumber || '';
                document.getElementById('applicationDate').value = customer.applicationDate || '';
                document.getElementById('breederName').value = customer.breederName || '';
                document.getElementById('breederUnit').value = customer.breederUnit || '';
                document.getElementById('breederAddress').value = customer.breederAddress || '';
                document.getElementById('breederPhone').value = customer.breederPhone || '';
                document.getElementById('applicantName').value = customer.applicantName || '';
                document.getElementById('applicantUnit').value = customer.applicantUnit || '';
                document.getElementById('applicantAddress').value = customer.applicantAddress || '';
                document.getElementById('applicantPhone').value = customer.applicantPhone || '';
                document.getElementById('varietyDescription').value = customer.varietyDescription || '';
                document.getElementById('technicalFeatures').value = customer.technicalFeatures || '';
                document.getElementById('marketProspect').value = customer.marketProspect || '';
                document.getElementById('address').value = customer.address || '';
                document.getElementById('remarks').value = customer.remarks || '';
                new bootstrap.Modal(document.getElementById('customerModal')).show();
            }
        }

        // 保存客户
        function saveCustomer() {
            const form = document.getElementById('customerForm');
            const formData = new FormData(form);
            
            const customerData = {
                customerName: formData.get('customerName'),
                contactPerson: formData.get('contactPerson'),
                phone: formData.get('phone'),
                email: formData.get('email'),
                customerType: formData.get('customerType'),
                region: formData.get('region'),
                applicationType: formData.get('applicationType'),
                companySize: formData.get('companySize'),
                industry: formData.get('industry'),
                annualRevenue: formData.get('annualRevenue'),
                varietyName: formData.get('varietyName'),
                varietyType: formData.get('varietyType'),
                applicationNumber: formData.get('applicationNumber'),
                applicationDate: formData.get('applicationDate'),
                breederName: formData.get('breederName'),
                breederUnit: formData.get('breederUnit'),
                breederAddress: formData.get('breederAddress'),
                breederPhone: formData.get('breederPhone'),
                applicantName: formData.get('applicantName'),
                applicantUnit: formData.get('applicantUnit'),
                applicantAddress: formData.get('applicantAddress'),
                applicantPhone: formData.get('applicantPhone'),
                varietyDescription: formData.get('varietyDescription'),
                technicalFeatures: formData.get('technicalFeatures'),
                marketProspect: formData.get('marketProspect'),
                address: formData.get('address'),
                remarks: formData.get('remarks')
            };

            const customerId = document.getElementById('customerId').value;
            
            if (customerId) {
                // 编辑模式
                const index = customers.findIndex(c => c.id == customerId);
                if (index !== -1) {
                    customers[index] = { ...customers[index], ...customerData };
                }
            } else {
                // 新增模式
                const newCustomer = {
                    id: customers.length + 1,
                    ...customerData,
                    createTime: new Date().toISOString().split('T')[0]
                };
                customers.push(newCustomer);
            }

            loadCustomers();
            bootstrap.Modal.getInstance(document.getElementById('customerModal')).hide();
            alert('保存成功！');
        }

        // 删除客户
        function deleteCustomer(id) {
            if (confirm('确定要删除这个客户吗？')) {
                customers = customers.filter(c => c.id !== id);
                loadCustomers();
                alert('删除成功！');
            }
        }

        // 批量删除
        function batchDelete() {
            if (selectedCustomers.length === 0) {
                alert('请先选择要删除的客户！');
                return;
            }
            
            if (confirm('确定要删除选中的 ' + selectedCustomers.length + ' 个客户吗？')) {
                customers = customers.filter(c => !selectedCustomers.includes(c.id));
                selectedCustomers = [];
                loadCustomers();
                alert('批量删除成功！');
            }
        }

        // 全选/取消全选
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.customer-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                if (selectAll.checked) {
                    if (!selectedCustomers.includes(parseInt(checkbox.value))) {
                        selectedCustomers.push(parseInt(checkbox.value));
                    }
                } else {
                    selectedCustomers = selectedCustomers.filter(id => id !== parseInt(checkbox.value));
                }
            });
        }

        // 切换客户选择状态
        function toggleCustomerSelection(id) {
            const index = selectedCustomers.indexOf(id);
            if (index > -1) {
                selectedCustomers.splice(index, 1);
            } else {
                selectedCustomers.push(id);
            }
        }

        // 刷新客户列表
        function refreshCustomers() {
            loadCustomers();
            alert('刷新成功！');
        }

        // 导入客户
        function importCustomers() {
            alert('导入功能开发中...');
        }

        // 导出客户
        function exportCustomers() {
            const dataStr = JSON.stringify(customers, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'customers_' + new Date().toISOString().split('T')[0] + '.json';
            link.click();
            URL.revokeObjectURL(url);
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>