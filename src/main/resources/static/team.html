<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>团队协作 - AI客户管理系统</title>
    <link href="/lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/lib/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/team.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="page-title">
                <i class="bi bi-people"></i> 团队协作
            </div>
            <a href="/" class="back-home-btn">
                <i class="bi bi-house-fill"></i> 返回首页
            </a>
        </div>
        
        <!-- 统计卡片 -->
        <div class="row mb-4">
            <div class="col-md-2">
                <div class="stats-card">
                    <div class="stats-number" id="totalMembers">8</div>
                    <div class="stats-label">团队成员</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stats-card">
                    <div class="stats-number" id="onlineMembers">5</div>
                    <div class="stats-label">在线成员</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stats-card">
                    <div class="stats-number" id="activeTasks">6</div>
                    <div class="stats-label">进行中任务</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stats-card">
                    <div class="stats-number" id="completedTasks">2</div>
                    <div class="stats-label">已完成任务</div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="stats-card">
                    <div class="stats-number" id="taskCompletionRate">25%</div>
                    <div class="stats-label">任务完成率</div>
                </div>
            </div>
        </div>

        <!-- 任务进度跟踪和汇报 -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-clipboard-data"></i> 任务进度跟踪和汇报
                </h5>
                <div>
                    <button class="btn btn-primary" onclick="showCreateReportModal()">
                        <i class="bi bi-plus"></i> 新建汇报
                    </button>
                    <button class="btn btn-outline-warning" onclick="showPendingReports()">
                        <i class="bi bi-clock"></i> 待审核
                    </button>
                    <button class="btn btn-outline-danger" onclick="showAbnormalReports()">
                        <i class="bi bi-exclamation-triangle"></i> 异常汇报
                    </button>
                    <button class="btn btn-outline-info" onclick="showReportStats()">
                        <i class="bi bi-graph-up"></i> 汇报统计
                    </button>
                </div>
            </div>
            <div class="card-body">
                <!-- 汇报统计卡片 -->
                <div class="row mb-4">
                    <div class="col-md-2">
                        <div class="stats-card">
                            <div class="stats-number" id="totalReports">0</div>
                            <div class="stats-label">总汇报数</div>
                    </div>
                </div>
                    <div class="col-md-2">
                        <div class="stats-card">
                            <div class="stats-number" id="pendingReports">0</div>
                            <div class="stats-label">待审核</div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stats-card">
                            <div class="stats-number" id="approvedReports">0</div>
                            <div class="stats-label">已通过</div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stats-card">
                            <div class="stats-number" id="abnormalReports">0</div>
                            <div class="stats-label">异常汇报</div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stats-card">
                            <div class="stats-number" id="avgScore">0.0</div>
                            <div class="stats-label">平均评分</div>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="stats-card">
                            <div class="stats-number" id="reportRate">0%</div>
                            <div class="stats-label">汇报完成率</div>
                        </div>
                    </div>
                </div>
                
                <!-- 汇报列表 -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>任务名称</th>
                                <th>员工姓名</th>
                                <th>汇报类型</th>
                                <th>汇报标题</th>
                                <th>进度</th>
                                <th>工作时长</th>
                                <th>汇报状态</th>
                                <th>评分</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- 汇报记录将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                </div>
                
                <!-- 分页 -->
                <nav aria-label="汇报记录分页">
                    <ul class="pagination justify-content-center" id="reportPagination">
                        <!-- 分页将通过JavaScript动态生成 -->
                    </ul>
                </nav>
            </div>
        </div>

        <!-- 任务管理 -->
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">团队任务</h5>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="filterTasks('all')">全部</button>
                    <button class="btn btn-outline-warning" onclick="filterTasks('pending')">进行中</button>
                    <button class="btn btn-outline-success" onclick="filterTasks('completed')">已完成</button>
                    <button class="btn btn-primary" onclick="showAddTaskModal()">
                        <i class="bi bi-plus"></i> 新建任务
                    </button>
                    <button class="btn btn-outline-info" onclick="importTasks()">
                        <i class="bi bi-upload"></i> 导入
                    </button>
                    <button class="btn btn-outline-secondary" onclick="exportTasks()">
                        <i class="bi bi-download"></i> 导出
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>任务名称</th>
                                <th>负责人</th>
                                <th>优先级</th>
                                <th>状态</th>
                                <th>截止日期</th>
                                <th>进度</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="taskTableBody">
                            <!-- 任务数据将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑成员模态框 -->
    <div class="modal fade" id="memberModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="memberModalTitle">添加成员</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="memberForm">
                        <input type="hidden" id="memberId" name="id">
                        <div class="mb-3">
                            <label class="form-label">姓名 *</label>
                            <input type="text" class="form-control" id="memberName" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">职位 *</label>
                            <input type="text" class="form-control" id="memberPosition" name="position" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">邮箱 *</label>
                            <input type="email" class="form-control" id="memberEmail" name="email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">电话</label>
                            <input type="tel" class="form-control" id="memberPhone" name="phone">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">部门</label>
                            <select class="form-select" id="memberDepartment" name="department">
                                <option value="">请选择</option>
                                <option value="销售部">销售部</option>
                                <option value="技术部">技术部</option>
                                <option value="客服部">客服部</option>
                                <option value="市场部">市场部</option>
                                <option value="行政部">行政部</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">角色</label>
                            <select class="form-select" id="memberRole" name="role">
                                <option value="">请选择</option>
                                <option value="管理员">管理员</option>
                                <option value="普通用户">普通用户</option>
                                <option value="只读用户">只读用户</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">工作模式</label>
                            <select class="form-select" id="memberWorkMode" name="workMode">
                                <option value="">请选择</option>
                                <option value="1">办公室</option>
                                <option value="2">远程</option>
                                <option value="3">混合</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">时区</label>
                            <select class="form-select" id="memberTimezone" name="timezone">
                                <option value="">请选择</option>
                                <option value="Asia/Shanghai">北京时间 (UTC+8)</option>
                                <option value="America/New_York">纽约时间 (UTC-5)</option>
                                <option value="Europe/London">伦敦时间 (UTC+0)</option>
                                <option value="Asia/Tokyo">东京时间 (UTC+9)</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">协作工具偏好</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="toolZoom" name="tools" value="zoom">
                                <label class="form-check-label" for="toolZoom">Zoom</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="toolTeams" name="tools" value="teams">
                                <label class="form-check-label" for="toolTeams">Microsoft Teams</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="toolSlack" name="tools" value="slack">
                                <label class="form-check-label" for="toolSlack">Slack</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveMember()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加/编辑任务模态框 -->
    <div class="modal fade" id="taskModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskModalTitle">新建任务</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="taskForm">
                        <input type="hidden" id="taskId" name="id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">任务名称 *</label>
                                    <input type="text" class="form-control" id="taskName" name="name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">负责人 *</label>
                                    <select class="form-select" id="taskAssignee" name="assignee" required>
                                        <option value="">请选择负责人</option>
                                        <!-- 选项将通过JavaScript动态加载 -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">优先级 *</label>
                                    <select class="form-select" id="taskPriority" name="priority" required>
                                        <option value="">请选择优先级</option>
                                        <option value="high">高</option>
                                        <option value="medium">中</option>
                                        <option value="low">低</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">截止日期 *</label>
                                    <input type="date" class="form-control" id="taskDueDate" name="dueDate" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">任务描述</label>
                            <textarea class="form-control" id="taskDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">进度 (%)</label>
                            <input type="number" class="form-control" id="taskProgress" name="progress" min="0" max="100" value="0">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveTask()">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建任务进度汇报模态框 -->
    <div class="modal fade" id="reportModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="reportModalTitle">新建任务进度汇报</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="reportForm">
                        <input type="hidden" id="reportId" name="id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">任务名称 *</label>
                                    <select class="form-select" id="reportTaskId" name="taskId" required>
                                        <option value="">请选择任务</option>
                                        <!-- 选项将通过JavaScript动态加载 -->
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">汇报类型 *</label>
                                    <select class="form-select" id="reportType" name="reportType" required>
                                        <option value="">请选择汇报类型</option>
                                        <option value="1">日报</option>
                                        <option value="2">周报</option>
                                        <option value="3">月报</option>
                                        <option value="4">项目汇报</option>
                                        <option value="5">紧急汇报</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">汇报标题 *</label>
                            <input type="text" class="form-control" id="reportTitle" name="reportTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">汇报内容 *</label>
                            <textarea class="form-control" id="reportContent" name="reportContent" rows="4" required></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">完成进度 (%) *</label>
                                    <input type="number" class="form-control" id="reportProgress" name="progress" min="0" max="100" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">工作时长 (分钟)</label>
                                    <input type="number" class="form-control" id="reportWorkDuration" name="workDuration" min="0">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">工作模式</label>
                                    <select class="form-select" id="reportWorkMode" name="workMode">
                                        <option value="">请选择</option>
                                        <option value="1">办公室</option>
                                        <option value="2">远程</option>
                                        <option value="3">混合</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">工作成果</label>
                            <textarea class="form-control" id="reportWorkResults" name="workResults" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">遇到的问题</label>
                            <textarea class="form-control" id="reportProblems" name="problems" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">解决方案</label>
                            <textarea class="form-control" id="reportSolutions" name="solutions" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">下一步计划</label>
                            <textarea class="form-control" id="reportNextPlan" name="nextPlan" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">需要支持</label>
                            <textarea class="form-control" id="reportSupportNeeded" name="supportNeeded" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">工作地点</label>
                            <input type="text" class="form-control" id="reportWorkLocation" name="workLocation">
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="reportIsAbnormal" name="isAbnormal">
                                <label class="form-check-label" for="reportIsAbnormal">标记为异常汇报</label>
                            </div>
                        </div>
                        <div class="mb-3" id="abnormalReasonDiv" style="display: none;">
                            <label class="form-label">异常原因</label>
                            <textarea class="form-control" id="reportAbnormalReason" name="abnormalReason" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveReport()">保存汇报</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 审核汇报模态框 -->
    <div class="modal fade" id="reviewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">审核任务进度汇报</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="reviewForm">
                        <input type="hidden" id="reviewReportId" name="reportId">
                        <div class="mb-3">
                            <label class="form-label">审核结果 *</label>
                            <select class="form-select" id="reviewStatus" name="reportStatus" required>
                                <option value="">请选择审核结果</option>
                                <option value="2">通过</option>
                                <option value="3">需修改</option>
                                <option value="4">驳回</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">审核意见</label>
                            <textarea class="form-control" id="reviewComment" name="reviewComment" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">质量评分 (1-5分)</label>
                                    <input type="number" class="form-control" id="reviewQualityScore" name="qualityScore" min="1" max="5">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">效率评分 (1-5分)</label>
                                    <input type="number" class="form-control" id="reviewEfficiencyScore" name="efficiencyScore" min="1" max="5">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">态度评分 (1-5分)</label>
                                    <input type="number" class="form-control" id="reviewAttitudeScore" name="attitudeScore" min="1" max="5">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="submitReview()">提交审核</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="meetingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="meetingModalTitle">创建远程会议</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="meetingForm">
                        <input type="hidden" id="meetingId" name="id">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">会议标题 *</label>
                                    <input type="text" class="form-control" id="meetingTitle" name="title" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">会议类型 *</label>
                                    <select class="form-select" id="meetingType" name="type" required>
                                        <option value="">请选择</option>
                                        <option value="1">团队会议</option>
                                        <option value="2">客户会议</option>
                                        <option value="3">项目讨论</option>
                                        <option value="4">培训</option>
                                        <option value="5">其他</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">开始时间 *</label>
                                    <input type="datetime-local" class="form-control" id="meetingStartTime" name="startTime" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">预计时长 (分钟)</label>
                                    <input type="number" class="form-control" id="meetingDuration" name="duration" min="15" max="480" value="60">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">会议工具</label>
                            <select class="form-select" id="meetingTool" name="tool">
                                <option value="zoom">Zoom</option>
                                <option value="teams">Microsoft Teams</option>
                                <option value="skype">Skype</option>
                                <option value="webex">Webex</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">参会人员</label>
                            <div class="participant-list" id="participantList">
                                <!-- 参会人员将通过JavaScript动态添加 -->
                            </div>
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="addParticipant()">
                                <i class="bi bi-person-plus"></i> 添加参会人员
                            </button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">会议描述</label>
                            <textarea class="form-control" id="meetingDescription" name="description" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="meetingRecord" name="record">
                                <label class="form-check-label" for="meetingRecord">录制会议</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="saveMeeting()">创建会议</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/lib/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/js/team.js"></script>
</body>
</html>
