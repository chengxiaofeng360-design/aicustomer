<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ™ºèƒ½èŠå¤© - AIå®¢æˆ·ç®¡ç†ç³»ç»Ÿ</title>
    <link href="/lib/bootstrap/bootstrap.min.css" rel="stylesheet">
    <link href="/lib/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/css/common.css" rel="stylesheet">
    <style>
        /* è¯­éŸ³åŠŸèƒ½æ ·å¼ */
        .recording-indicator {
            animation: pulse 1s infinite;
        }
        
        .recording-animation {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #dc3545;
        }
        
        .recording-dots {
            display: flex;
            gap: 3px;
        }
        
        .recording-dots span {
            width: 6px;
            height: 6px;
            background: #dc3545;
            border-radius: 50%;
            animation: recordingPulse 1.5s infinite;
        }
        
        .recording-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .recording-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes recordingPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .voice-result {
            background: rgba(13, 110, 253, 0.1);
            border-left: 4px solid #0d6efd;
        }
        
        .voice-recognition-result {
            display: flex;
            align-items: center;
            color: #0d6efd;
            font-weight: 500;
        }
        
        .speaking-indicator {
            animation: speakingPulse 2s infinite;
        }
        
        .speaking-animation {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #198754;
        }
        
        .speaking-waves {
            display: flex;
            gap: 2px;
            align-items: center;
        }
        
        .speaking-waves span {
            width: 3px;
            height: 15px;
            background: #198754;
            border-radius: 2px;
            animation: speakingWave 1.5s infinite;
        }
        
        .speaking-waves span:nth-child(1) { animation-delay: 0s; }
        .speaking-waves span:nth-child(2) { animation-delay: 0.1s; }
        .speaking-waves span:nth-child(3) { animation-delay: 0.2s; }
        .speaking-waves span:nth-child(4) { animation-delay: 0.3s; }
        
        @keyframes speakingWave {
            0%, 100% { height: 15px; opacity: 0.5; }
            50% { height: 25px; opacity: 1; }
        }
        
        @keyframes speakingPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* è¯­éŸ³æŒ‰é’®çŠ¶æ€ */
        .voice-btn-recording {
            background: #dc3545 !important;
            border-color: #dc3545 !important;
            color: white !important;
        }
        
        .voice-btn-recording:hover {
            background: #bb2d3b !important;
            border-color: #bb2d3b !important;
        }
        
        /* æ¶ˆæ¯æ“ä½œæŒ‰é’®æ ·å¼ */
        .message-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .message:hover .message-actions {
            opacity: 1;
        }
        
        .message-actions .btn {
            padding: 2px 6px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .message-text {
            margin-bottom: 0;
        }
        
        /* Toastæ ·å¼ */
        .toast {
            min-width: 250px;
        }
        
        .toast-header {
            background: rgba(25, 135, 84, 0.1);
            border-bottom: 1px solid rgba(25, 135, 84, 0.2);
        }
        
        /* æƒé™è¯·æ±‚æ ·å¼ */
        .permission-request {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
        }
        
        .permission-request-content {
            color: #856404;
        }
        
        .permission-steps {
            background: rgba(255, 193, 7, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .permission-steps p {
            margin-bottom: 5px;
            color: #856404;
        }
        
        /* è¯­éŸ³é”™è¯¯æ ·å¼ */
        .voice-error {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
        }
        
        .voice-error-content {
            color: #721c24;
        }
        
        .error-solutions {
            background: rgba(220, 53, 69, 0.05);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .error-solutions h6 {
            color: #721c24;
            font-weight: 600;
        }
        
        .error-solutions ul {
            color: #721c24;
            padding-left: 20px;
        }
        
        .error-solutions li {
            margin-bottom: 5px;
        }
        
        .error-message {
            font-weight: 500;
        }
        
        /* è¯­éŸ³æŒ‡å—æ ·å¼ */
        .voice-guide {
            background: rgba(13, 110, 253, 0.1);
            border-left: 4px solid #0d6efd;
        }
        
        .voice-guide-content {
            color: #0c63e4;
        }
        
        .guide-section {
            margin-bottom: 20px;
        }
        
        .guide-section h6 {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .guide-section ol,
        .guide-section ul {
            padding-left: 20px;
        }
        
        .guide-section li {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        .supported-questions {
            margin-top: 10px;
        }
        
        .supported-questions .badge {
            margin-bottom: 5px;
        }
        
        .guide-actions {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid rgba(13, 110, 253, 0.2);
        }
        
        .guide-actions .btn {
            margin: 0 5px;
        }
        
        /* èŠå¤©å®¹å™¨æ»šåŠ¨ä¼˜åŒ– */
        .chat-messages-container {
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        
        .chat-messages {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        /* ç¡®ä¿æ¶ˆæ¯å®¹å™¨èƒ½å¤Ÿæ­£ç¡®æ»šåŠ¨ */
        .chat-messages-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .chat-messages-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .chat-messages-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* å…¨å±èŠå¤©å¸ƒå±€ */
        .main-container {
            padding: 0 !important;
            margin: 0 !important;
            min-height: 100vh;
            background: #f8fafc;
        }
        
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .page-title {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }
        
        .back-home-btn {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            background: rgba(255,255,255,0.2);
            transition: all 0.2s ease;
        }
        
        .back-home-btn:hover {
            background: rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
        }
        
        .chat-main-container {
            height: calc(100vh - 80px) !important;
            margin: 0 !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }
        
        .chat-sidebar {
            width: 280px !important;
            min-width: 280px;
            transition: width 0.3s ease;
        }
        
        .chat-sidebar.collapsed {
            width: 60px !important;
            min-width: 60px;
        }
        
        .chat-sidebar.collapsed .sidebar-header h5,
        .chat-sidebar.collapsed .sidebar-header .status-text,
        .chat-sidebar.collapsed .current-chat-section h6,
        .chat-sidebar.collapsed .current-chat-item span,
        .chat-sidebar.collapsed .chat-history h6,
        .chat-sidebar.collapsed .history-item span,
        .chat-sidebar.collapsed .quick-actions-header h6,
        .chat-sidebar.collapsed .quick-action-btn span {
            display: none;
        }
        
        .chat-sidebar.collapsed .sidebar-header,
        .chat-sidebar.collapsed .current-chat-section,
        .chat-sidebar.collapsed .chat-history,
        .chat-sidebar.collapsed .quick-actions {
            padding: 10px 5px;
        }
        
        .chat-sidebar.collapsed .current-chat-item,
        .chat-sidebar.collapsed .history-item,
        .chat-sidebar.collapsed .quick-action-btn {
            justify-content: center;
            padding: 8px;
        }
        
        .sidebar-toggle {
            position: absolute;
            top: 20px;
            right: -15px;
            width: 30px;
            height: 30px;
            background: #667eea;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .sidebar-toggle:hover {
            background: #5a6fd8;
            transform: scale(1.1);
        }
        
        .chat-main-area {
            flex: 1;
            min-width: 0;
        }
        
        /* ç°ä»£åŒ–èŠå¤©è¾“å…¥æ¡†æ ·å¼ */
        .chat-input-area {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-top: 1px solid #e3e6ea;
            padding: 20px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            backdrop-filter: blur(10px);
        }
        
        .input-wrapper {
            display: grid;
            grid-template-columns: 140px 1fr 100px;
            gap: 16px;
            align-items: end;
            margin-bottom: 12px;
        }
        
        /* å·¦ä¾§å·¥å…·æ  - ç°ä»£åŒ–è®¾è®¡ */
        .input-toolbar {
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 140px;
        }
        
        .toolbar-group {
            display: flex;
            gap: 10px;
        }
        
        .toolbar-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid #e9ecef;
            border-radius: 16px;
            color: #6c757d;
            text-decoration: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            position: relative;
            overflow: hidden;
        }
        
        .toolbar-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .toolbar-btn:hover::before {
            left: 100%;
        }
        
        .toolbar-btn:hover {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-color: #0d6efd;
            color: #0d6efd;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.15);
        }
        
        .toolbar-btn i {
            font-size: 18px;
            margin-bottom: 3px;
            transition: transform 0.2s ease;
        }
        
        .toolbar-btn:hover i {
            transform: scale(1.1);
        }
        
        .toolbar-label {
            font-size: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        /* ä¸­é—´è¾“å…¥æ¡† - ç°ä»£åŒ–è®¾è®¡ */
        .input-main {
            flex: 1;
            min-width: 0;
        }
        
        .input-box {
            position: relative;
            background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
            border: 2px solid #e9ecef;
            border-radius: 20px;
            padding: 16px 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            width: 100%;
            max-width: none;
        }
        
        .input-box:focus-within {
            border-color: #0d6efd;
            box-shadow: 0 8px 30px rgba(13, 110, 253, 0.2);
            transform: translateY(-1px);
        }
        
        .chat-input {
            border: none;
            background: transparent;
            resize: none;
            outline: none;
            font-size: 15px;
            line-height: 1.5;
            min-height: 24px;
            max-height: 120px;
            width: 100%;
            padding: 0;
            color: #2c3e50;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .chat-input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }
        
        .input-actions-inline {
            position: absolute;
            top: 12px;
            right: 12px;
        }
        
        .input-actions-inline .btn {
            padding: 6px 8px;
            font-size: 12px;
            border-radius: 8px;
            background: rgba(108, 117, 125, 0.1);
            border: none;
            color: #6c757d;
            transition: all 0.2s ease;
        }
        
        .input-actions-inline .btn:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        /* å³ä¾§å‘é€æŒ‰é’® - ç°ä»£åŒ–è®¾è®¡ */
        .input-send {
            min-width: 100px;
        }
        
        .send-btn {
            width: 100%;
            height: 56px;
            border-radius: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #0d6efd 0%, #6610f2 100%);
            border: none;
            color: white;
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .send-btn:hover::before {
            left: 100%;
        }
        
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.4);
            background: linear-gradient(135deg, #0056b3 0%, #520dc2 100%);
        }
        
        .send-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
        }
        
        .send-label {
            font-size: 14px;
            font-weight: 600;
        }
        
        /* åº•éƒ¨çŠ¶æ€æ  - ç®€åŒ–è®¾è®¡ */
        .input-status {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 8px 0 0 0;
            border-top: 1px solid #f1f3f4;
            margin-top: 12px;
        }
        
        .status-text {
            font-size: 13px;
            color: #6c757d;
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }
        
        .status-text i {
            color: #0d6efd;
        }
        
        .char-count {
            font-size: 13px;
            color: #6c757d;
            font-weight: 600;
            padding: 4px 8px;
            background: rgba(108, 117, 125, 0.1);
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .chat-sidebar {
                width: 250px !important;
                min-width: 250px;
            }
        }
        
        @media (max-width: 992px) {
            .chat-sidebar {
                width: 200px !important;
                min-width: 200px;
            }
            
            .input-wrapper {
                gap: 12px;
            }
            
            .toolbar-btn {
                width: 50px;
                height: 50px;
            }
            
            .send-btn {
                height: 50px;
            }
        }
        
        @media (max-width: 768px) {
            .chat-main-container {
                flex-direction: column;
                height: calc(100vh - 70px) !important;
            }
            
            .chat-sidebar {
                width: 100% !important;
                min-width: auto;
                height: auto;
                max-height: 200px;
                order: 2;
            }
            
            .chat-main-area {
                order: 1;
                height: calc(100vh - 270px);
            }
            
            .input-wrapper {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .input-toolbar {
                flex-direction: row;
                justify-content: center;
                min-width: auto;
                order: 2;
            }
            
            .input-main {
                order: 1;
            }
            
            .input-send {
                order: 3;
                min-width: auto;
            }
            
            .toolbar-group {
                gap: 12px;
            }
            
            .toolbar-btn {
                width: 45px;
                height: 45px;
            }
            
            .send-btn {
                height: 45px;
            }
            
            .input-box {
                padding: 14px 16px;
            }
        }
        
        /* è¯­éŸ³æŒ‰é’®å½•éŸ³çŠ¶æ€ */
        .toolbar-btn.recording {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            border-color: #dc3545;
            color: white;
            animation: recordingPulse 1.5s infinite;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }
        
        .toolbar-btn.recording:hover {
            background: linear-gradient(135deg, #c82333 0%, #a71e2a 100%);
            border-color: #c82333;
            transform: translateY(-2px);
        }
        
        @keyframes recordingPulse {
            0%, 100% { 
                box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
            }
            50% { 
                box-shadow: 0 4px 25px rgba(220, 53, 69, 0.6);
            }
        }
        
        /* è¾“å…¥æ¡†åŠ¨ç”»æ•ˆæœ */
        .input-box {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- é¡µé¢å¤´éƒ¨ -->
        <div class="page-header">
            <div class="page-title">
                <i class="bi bi-chat-dots"></i> AIæ™ºèƒ½èŠå¤©
            </div>
            <a href="/" class="back-home-btn">
                <i class="bi bi-house-fill"></i> è¿”å›é¦–é¡µ
            </a>
        </div>
        
        <!-- èŠå¤©ä¸»å®¹å™¨ -->
        <div class="chat-main-container">
            <!-- ä¾§è¾¹æ  -->
            <div class="chat-sidebar" id="chatSidebar">
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="æŠ˜å /å±•å¼€ä¾§è¾¹æ ">
                    <i class="bi bi-chevron-left" id="sidebarToggleIcon"></i>
                </button>
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0 text-white">
                            <i class="bi bi-robot me-2"></i>AIåŠ©æ‰‹
                        </h5>
                        <button class="btn btn-light btn-sm" onclick="startNewChat()" title="æ–°å¯¹è¯">
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                    <div class="ai-status">
                        <div class="status-indicator online"></div>
                        <span class="status-text">åœ¨çº¿æœåŠ¡ä¸­</span>
                    </div>
                </div>
                
                <!-- å½“å‰å¯¹è¯ -->
                <div class="current-chat-section">
                    <h6 class="text-white mb-3">
                        <i class="bi bi-chat-dots me-2"></i>å½“å‰å¯¹è¯
                    </h6>
                    <div class="current-chat-info">
                        <div class="current-chat-item active">
                            <i class="bi bi-chat-square-text"></i>
                            <span>ä¸AIåŠ©æ‰‹çš„å¯¹è¯</span>
                        </div>
                    </div>
                </div>
                
                <!-- å¯¹è¯å†å² -->
                <div class="chat-history">
                    <h6 class="text-white mb-3">
                        <i class="bi bi-clock-history me-2"></i>å¯¹è¯å†å²
                    </h6>
                    <div class="history-list" id="historyList">
                        <div class="history-item">
                            <i class="bi bi-chat-dots"></i>
                            <span>å†å²å¯¹è¯ 1</span>
                        </div>
                        <div class="history-item">
                            <i class="bi bi-chat-dots"></i>
                            <span>å†å²å¯¹è¯ 2</span>
                        </div>
                        <div class="history-item">
                            <i class="bi bi-chat-dots"></i>
                            <span>å†å²å¯¹è¯ 3</span>
                        </div>
                    </div>
                </div>
                
                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="quick-actions-sidebar">
                    <div class="quick-actions-header" onclick="toggleQuickActions()">
                        <h6 class="text-white mb-0">
                            <i class="bi bi-lightning me-2"></i>å¿«é€Ÿæ“ä½œ
                        </h6>
                        <i class="bi bi-chevron-down toggle-icon" id="quickActionsToggle"></i>
                    </div>
                    <div class="quick-actions-content" id="quickActionsContent">
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn" onclick="sendQuickMessage('å®¢æˆ·æ»¡æ„åº¦åˆ†æ')">
                                <i class="bi bi-graph-up"></i>
                                <span>å®¢æˆ·æ»¡æ„åº¦</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('è¥é”€ç­–ç•¥å»ºè®®')">
                                <i class="bi bi-bullseye"></i>
                                <span>è¥é”€ç­–ç•¥</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('äº§å“æ¨è')">
                                <i class="bi bi-box-seam"></i>
                                <span>äº§å“æ¨è</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('å¸‚åœºè¶‹åŠ¿åˆ†æ')">
                                <i class="bi bi-trending-up"></i>
                                <span>å¸‚åœºè¶‹åŠ¿</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('å®¢æˆ·æœåŠ¡ä¼˜åŒ–')">
                                <i class="bi bi-headset"></i>
                                <span>æœåŠ¡ä¼˜åŒ–</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('æ•°æ®åˆ†ææŠ¥å‘Š')">
                                <i class="bi bi-file-earmark-bar-graph"></i>
                                <span>æ•°æ®åˆ†æ</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ä¸»èŠå¤©åŒºåŸŸ -->
            <div class="chat-main-area">
                <!-- èŠå¤©å¤´éƒ¨ -->
                <div class="chat-header">
                    <div class="chat-title">
                        <div class="ai-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">AIæ™ºèƒ½åŠ©æ‰‹</h6>
                            <small class="text-muted">ä¸“ä¸šç§ä¸šé¡¾é—® Â· 24å°æ—¶åœ¨çº¿</small>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn btn-outline-secondary btn-sm" onclick="clearChat()" title="æ¸…ç©ºå¯¹è¯">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="exportChat()" title="å¯¼å‡ºå¯¹è¯">
                            <i class="bi bi-download"></i>
                        </button>
                        <button class="btn btn-outline-info btn-sm" onclick="testScroll()" title="æµ‹è¯•æ»šåŠ¨">
                            <i class="bi bi-arrow-down-circle"></i>
                        </button>
                    </div>
                </div>
                
                <!-- æ¶ˆæ¯å®¹å™¨ -->
                <div class="chat-messages-container">
                    <div class="chat-messages" id="chatMessages">
                        <!-- æ¬¢è¿æ¶ˆæ¯ -->
                        <div class="message ai-message">
                            <div class="message-avatar">
                                <i class="bi bi-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-bubble">
                                    <div class="welcome-content">
                                        <h6 class="welcome-title">
                                            <i class="bi bi-sparkles me-2"></i>æ¬¢è¿ä½¿ç”¨AIæ™ºèƒ½åŠ©æ‰‹
                                        </h6>
                                        <p>æ‚¨å¥½ï¼æˆ‘æ˜¯ä¸“é—¨ä¸ºç§ä¸šå®¢æˆ·ç®¡ç†ç³»ç»Ÿè®¾è®¡çš„AIæ™ºèƒ½åŠ©æ‰‹ã€‚</p>
                                        <div class="capabilities">
                                            <h6>æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ï¼š</h6>
                                            <div class="capability-grid">
                                                <div class="capability-item">
                                                    <i class="bi bi-graph-up"></i>
                                                    <span>æ•°æ®åˆ†æ</span>
                                                </div>
                                                <div class="capability-item">
                                                    <i class="bi bi-bullseye"></i>
                                                    <span>è¥é”€ç­–ç•¥</span>
                                                </div>
                                                <div class="capability-item">
                                                    <i class="bi bi-box-seam"></i>
                                                    <span>äº§å“æ¨è</span>
                                                </div>
                                                <div class="capability-item">
                                                    <i class="bi bi-headset"></i>
                                                    <span>å®¢æˆ·æœåŠ¡</span>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="welcome-footer">è¯·éšæ—¶å‘æˆ‘æé—®ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›ä¸“ä¸šçš„å»ºè®®å’Œå¸®åŠ©ï¼</p>
                                    </div>
                                </div>
                                <div class="message-time">åˆšåˆš</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- è¾“å…¥åŒºåŸŸ -->
                <div class="chat-input-area">
                    <div class="input-wrapper">
                        <!-- å·¦ä¾§å·¥å…·æ  -->
                        <div class="input-toolbar">
                            <div class="toolbar-group">
                                <button class="toolbar-btn" onclick="attachFile()" title="ä¸Šä¼ æ–‡ä»¶">
                            <i class="bi bi-paperclip"></i>
                                    <span class="toolbar-label">æ–‡ä»¶</span>
                        </button>
                                <button class="toolbar-btn" onclick="startVoiceInput()" title="è¯­éŸ³è¾“å…¥" id="voiceInputBtn">
                            <i class="bi bi-mic"></i>
                                    <span class="toolbar-label">è¯­éŸ³</span>
                        </button>
                            </div>
                            <div class="toolbar-group">
                                <button class="toolbar-btn" onclick="toggleEmoji()" title="è¡¨æƒ…ç¬¦å·">
                            <i class="bi bi-emoji-smile"></i>
                                    <span class="toolbar-label">è¡¨æƒ…</span>
                                </button>
                                <button class="toolbar-btn" onclick="showVoiceGuide()" title="è¯­éŸ³ä½¿ç”¨æŒ‡å—">
                                    <i class="bi bi-question-circle"></i>
                                    <span class="toolbar-label">å¸®åŠ©</span>
                        </button>
                    </div>
                        </div>
                        
                        <!-- ä¸­é—´è¾“å…¥æ¡† -->
                        <div class="input-main" style="flex: 1; min-width: 0; width: 100%;">
                            <div class="input-box" style="width: 100%; max-width: none; min-width: 500px;">
                        <textarea 
                            class="form-control chat-input" 
                            id="messageInput" 
                                    placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜æˆ–ä½¿ç”¨è¯­éŸ³è¾“å…¥..." 
                            rows="1"
                            onkeypress="handleKeyPress(event)"
                            oninput="autoResize(this)"
                            style="width: 100%; min-width: 500px;"
                        ></textarea>
                                <div class="input-actions-inline">
                                    <button class="btn btn-outline-secondary btn-sm" onclick="clearInput()" title="æ¸…ç©º">
                                        <i class="bi bi-x"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å³ä¾§å‘é€æŒ‰é’® -->
                        <div class="input-send">
                            <button class="btn btn-primary send-btn" onclick="sendMessage()" id="sendBtn" title="å‘é€æ¶ˆæ¯">
                            <i class="bi bi-send"></i>
                                <span class="send-label">å‘é€</span>
                        </button>
                    </div>
                </div>
                    
                    <!-- åº•éƒ¨çŠ¶æ€æ  -->
                    <div class="input-status">
                        <div class="status-right">
                            <span class="char-count" id="charCount">0/1000</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/lib/bootstrap/bootstrap.bundle.min.js"></script>
    <script>
        let chatHistory = [];
        let isTyping = false;
        let currentChatId = Date.now();

        // ä¾§è¾¹æ æŠ˜å /å±•å¼€åŠŸèƒ½
        function toggleSidebar() {
            const sidebar = document.getElementById('chatSidebar');
            const toggleIcon = document.getElementById('sidebarToggleIcon');
            
            if (sidebar.classList.contains('collapsed')) {
                sidebar.classList.remove('collapsed');
                toggleIcon.className = 'bi bi-chevron-left';
            } else {
                sidebar.classList.add('collapsed');
                toggleIcon.className = 'bi bi-chevron-right';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // èšç„¦åˆ°è¾“å…¥æ¡†
            document.getElementById('messageInput').focus();
            
            // åˆå§‹åŒ–èŠå¤©ç•Œé¢
            initializeChat();
        });

        // åˆå§‹åŒ–èŠå¤©ç•Œé¢
        function initializeChat() {
            // æ·»åŠ æ¬¢è¿æ¶ˆæ¯åˆ°å†å²è®°å½•
            addToHistory('æ¬¢è¿ä½¿ç”¨AIæ™ºèƒ½åŠ©æ‰‹', 'ai', 'åˆšåˆš');
        }

        // å‘é€æ¶ˆæ¯
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(message, 'user');
            
            // æ¸…ç©ºè¾“å…¥æ¡†å¹¶é‡ç½®é«˜åº¦
            input.value = '';
            autoResize(input);
            
            // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥çŠ¶æ€
            showTypingIndicator();
            
            // æ¨¡æ‹ŸAIå›å¤
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'ai');
            }, 1500 + Math.random() * 1000);
        }

        // å‘é€å¿«é€Ÿæ¶ˆæ¯
        function sendQuickMessage(message) {
            // è®¾ç½®è¾“å…¥æ¡†å†…å®¹
            document.getElementById('messageInput').value = message;
            
            // æ»šåŠ¨åˆ°èŠå¤©åŒºåŸŸ
            scrollToChatArea();
            
            // å‘é€æ¶ˆæ¯
            sendMessage();
        }
        
        // æ»šåŠ¨åˆ°èŠå¤©åŒºåŸŸ
        function scrollToChatArea() {
            const chatArea = document.querySelector('.chat-main-area');
            if (chatArea) {
                chatArea.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                
                // èšç„¦åˆ°è¾“å…¥æ¡†
                setTimeout(() => {
                    document.getElementById('messageInput').focus();
                }, 500);
            }
        }

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©ç•Œé¢
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${content}</p>
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                    <div class="message-avatar">
                        <i class="bi bi-person-fill"></i>
                    </div>
                `;
            } else {
                // AIæ¶ˆæ¯æ·»åŠ è¯­éŸ³æ’­æ”¾æŒ‰é’®
                const messageId = 'msg_' + Date.now();
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="bi bi-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">${content}</div>
                            <div class="message-actions">
                                <button class="btn btn-outline-primary btn-sm" onclick="speakText('${content.replace(/'/g, "\\'")}')" title="æ’­æ”¾è¯­éŸ³">
                                    <i class="bi bi-volume-up"></i>
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="copyMessage('${messageId}')" title="å¤åˆ¶å†…å®¹">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
                messageDiv.id = messageId;
            }
            
            messagesContainer.appendChild(messageDiv);
            
            // ç«‹å³æ»šåŠ¨
            scrollToBottom();
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                forceScrollToBottom();
            }, 100);
            
            // ä¿å­˜åˆ°èŠå¤©å†å²
            addToHistory(content, sender, time);
        }
        
        // å¤åˆ¶æ¶ˆæ¯å†…å®¹
        function copyMessage(messageId) {
            const messageDiv = document.getElementById(messageId);
            const messageText = messageDiv.querySelector('.message-text').textContent;
            
            navigator.clipboard.writeText(messageText).then(() => {
                // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
                showCopySuccess();
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶');
            });
        }
        
        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
        function showCopySuccess() {
            const toast = document.createElement('div');
            toast.className = 'toast show position-fixed';
            toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999;';
            toast.innerHTML = `
                <div class="toast-header">
                    <i class="bi bi-check-circle text-success me-2"></i>
                    <strong class="me-auto">å¤åˆ¶æˆåŠŸ</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    æ¶ˆæ¯å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿
                </div>
            `;
            
            document.body.appendChild(toast);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 3000);
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(content, sender, time) {
            chatHistory.push({
                content: content,
                sender: sender,
                time: time,
                chatId: currentChatId
            });
        }

        // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥çŠ¶æ€
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            
            // ç«‹å³æ»šåŠ¨
            scrollToBottom();
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                forceScrollToBottom();
            }, 100);
        }

        // éšè—æ­£åœ¨è¾“å…¥çŠ¶æ€
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // æ»šåŠ¨åˆ°åº•éƒ¨
        function scrollToBottom() {
            // è·å–æ­£ç¡®çš„æ»šåŠ¨å®¹å™¨
            const scrollContainer = document.querySelector('.chat-messages-container');
            const messagesContainer = document.getElementById('chatMessages');
            
            if (scrollContainer && messagesContainer) {
                // ä½¿ç”¨å¹³æ»‘æ»šåŠ¨
                scrollContainer.scrollTo({
                    top: scrollContainer.scrollHeight,
                    behavior: 'smooth'
                });
                
                // å¤‡ç”¨æ–¹æ¡ˆï¼šç›´æ¥è®¾ç½®scrollTop
                setTimeout(() => {
                    scrollContainer.scrollTop = scrollContainer.scrollHeight;
                }, 100);
                
                // è°ƒè¯•ä¿¡æ¯
                console.log('æ»šåŠ¨å®¹å™¨é«˜åº¦:', scrollContainer.scrollHeight);
                console.log('å½“å‰æ»šåŠ¨ä½ç½®:', scrollContainer.scrollTop);
            }
        }
        
        // å¼ºåˆ¶æ»šåŠ¨åˆ°åº•éƒ¨ï¼ˆç”¨äºç¡®ä¿æ»šåŠ¨ç”Ÿæ•ˆï¼‰
        function forceScrollToBottom() {
            const scrollContainer = document.querySelector('.chat-messages-container');
            if (scrollContainer) {
                // å¤šæ¬¡å°è¯•ç¡®ä¿æ»šåŠ¨åˆ°åº•éƒ¨
                const scrollToBottom = () => {
                    scrollContainer.scrollTop = scrollContainer.scrollHeight;
                };
                
                scrollToBottom();
                setTimeout(scrollToBottom, 50);
                setTimeout(scrollToBottom, 100);
                setTimeout(scrollToBottom, 200);
                setTimeout(scrollToBottom, 500);
            }
        }

        // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
            
            // æ›´æ–°å­—ç¬¦è®¡æ•°
            updateCharCount();
        }
        
        // æ›´æ–°å­—ç¬¦è®¡æ•°
        function updateCharCount() {
            const input = document.getElementById('messageInput');
            const charCount = document.getElementById('charCount');
            const length = input.value.length;
            const maxLength = 1000;
            
            charCount.textContent = `${length}/${maxLength}`;
            
            if (length > maxLength * 0.9) {
                charCount.style.color = '#dc3545';
            } else if (length > maxLength * 0.7) {
                charCount.style.color = '#ffc107';
            } else {
                charCount.style.color = '#6c757d';
            }
        }
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        function clearInput() {
            const input = document.getElementById('messageInput');
            input.value = '';
            autoResize(input);
            input.focus();
        }

        // ç”ŸæˆAIå›å¤
        function generateAIResponse(userMessage) {
            const responses = {
                'å®¢æˆ·æ»¡æ„åº¦åˆ†æ': `ğŸ“Š **å®¢æˆ·æ»¡æ„åº¦æ·±åº¦åˆ†ææŠ¥å‘Š**

æ ¹æ®æœ€æ–°çš„æ•°æ®åˆ†æï¼Œæˆ‘ä¸ºæ‚¨æä¾›ä»¥ä¸‹æ´å¯Ÿï¼š

**æ•´ä½“æ»¡æ„åº¦æŒ‡æ ‡ï¼š**
â€¢ ç»¼åˆæ»¡æ„åº¦ï¼š89.2% â¬†ï¸ (+2.3%)
â€¢ äº§å“æ»¡æ„åº¦ï¼š92.1% â¬†ï¸ (+1.8%)
â€¢ æœåŠ¡æ»¡æ„åº¦ï¼š85.7% â¬†ï¸ (+3.2%)
â€¢ å“åº”é€Ÿåº¦ï¼š88.9% â¬†ï¸ (+4.1%)

**å…³é”®å‘ç°ï¼š**
1. **æœåŠ¡ç¯èŠ‚**æ˜¯ä¸»è¦æ”¹è¿›ç‚¹ï¼Œå»ºè®®åŠ å¼ºå®¢æœåŸ¹è®­
2. **å“åº”é€Ÿåº¦**æ˜¾è‘—æå‡ï¼Œå®¢æˆ·åé¦ˆç§¯æ
3. **VIPå®¢æˆ·**æ»¡æ„åº¦è¾¾åˆ°95.2%ï¼Œè¡¨ç°ä¼˜å¼‚
4. **æ–°å®¢æˆ·**æ»¡æ„åº¦ç›¸å¯¹è¾ƒä½ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨

**æ”¹è¿›å»ºè®®ï¼š**
â€¢ å»ºç«‹å®¢æˆ·æ»¡æ„åº¦å®æ—¶ç›‘æ§ç³»ç»Ÿ
â€¢ å®šæœŸè¿›è¡Œå®¢æˆ·å›è®¿å’Œè°ƒç ”
â€¢ ä¼˜åŒ–æœåŠ¡æµç¨‹ï¼Œæå‡å“åº”æ•ˆç‡
â€¢ åŠ å¼ºæ–°å®¢æˆ·å…³æ€€å’Œå¼•å¯¼

éœ€è¦æˆ‘ä¸ºæ‚¨ç”Ÿæˆè¯¦ç»†çš„æ”¹è¿›æ–¹æ¡ˆå—ï¼Ÿ`,

                'è¥é”€ç­–ç•¥å»ºè®®': `ğŸ¯ **æ™ºèƒ½è¥é”€ç­–ç•¥å»ºè®®**

åŸºäºå½“å‰å¸‚åœºç¯å¢ƒå’Œå®¢æˆ·æ•°æ®ï¼Œæˆ‘ä¸ºæ‚¨åˆ¶å®šä»¥ä¸‹è¥é”€ç­–ç•¥ï¼š

**1. æ•°å­—åŒ–è¥é”€å‡çº§**
â€¢ å»ºç«‹å…¨æ¸ é“è¥é”€ä½“ç³»
â€¢ åˆ©ç”¨AIè¿›è¡Œç²¾å‡†å®¢æˆ·ç”»åƒ
â€¢ å®æ–½ä¸ªæ€§åŒ–è¥é”€æ¨é€
â€¢ ä¼˜åŒ–çº¿ä¸Šé”€å”®è½¬åŒ–ç‡

**2. å®¢æˆ·ç»†åˆ†ç­–ç•¥**
â€¢ é«˜ä»·å€¼å®¢æˆ·ï¼šVIPä¸“å±æœåŠ¡
â€¢ æˆé•¿å‹å®¢æˆ·ï¼šåŸ¹è‚²å’Œå¼•å¯¼
â€¢ æ½œåœ¨å®¢æˆ·ï¼šç²¾å‡†è§¦è¾¾
â€¢ æµå¤±å®¢æˆ·ï¼šæŒ½å›è®¡åˆ’

**3. äº§å“å·®å¼‚åŒ–å®šä½**
â€¢ çªå‡ºæŠ€æœ¯ä¼˜åŠ¿å’Œå“è´¨ä¿è¯
â€¢ å¼ºè°ƒæœåŠ¡ç‰¹è‰²å’Œå®¢æˆ·ä»·å€¼
â€¢ å»ºç«‹å“ç‰Œå·®å¼‚åŒ–ä¼˜åŠ¿
â€¢ åˆ¶å®šç«äº‰ç­–ç•¥

**4. å®¢æˆ·å…³ç³»ç»´æŠ¤**
â€¢ å»ºç«‹å®¢æˆ·ç”Ÿå‘½å‘¨æœŸç®¡ç†
â€¢ å®æ–½å®¢æˆ·æˆåŠŸè®¡åˆ’
â€¢ å®šæœŸå®¢æˆ·æ»¡æ„åº¦è°ƒç ”
â€¢ å»ºç«‹å®¢æˆ·åé¦ˆæœºåˆ¶

**é¢„æœŸæ•ˆæœï¼š**
â€¢ å®¢æˆ·è½¬åŒ–ç‡æå‡30%
â€¢ å®¢æˆ·ç•™å­˜ç‡æå‡25%
â€¢ è¥é”€æˆæœ¬é™ä½20%
â€¢ å®¢æˆ·æ»¡æ„åº¦æå‡15%

æ‚¨å¸Œæœ›æˆ‘è¯¦ç»†åˆ†æå“ªä¸ªç­–ç•¥æ¨¡å—ï¼Ÿ`,

                'äº§å“æ¨è': `ğŸ›ï¸ **ä¸ªæ€§åŒ–äº§å“æ¨èæ–¹æ¡ˆ**

åŸºäºæ‚¨çš„å®¢æˆ·ç”»åƒå’Œå¸‚åœºåˆ†æï¼Œæˆ‘ä¸ºæ‚¨æ¨èä»¥ä¸‹äº§å“ç»„åˆï¼š

**ğŸŒ¾ æ ¸å¿ƒäº§å“æ¨è**
1. **æŠ—ç—…æ€§æ°´ç¨»å“ç§**
   - é€‚åˆç—…è™«å®³å¤šå‘åœ°åŒº
   - äº§é‡æå‡15-20%
   - å®¢æˆ·æ»¡æ„åº¦95%+
   - æŠ•èµ„å›æŠ¥ç‡ï¼š1:3.2

2. **é«˜æ•ˆè‚¥æ–™äº§å“**
   - ç¯ä¿å‹æœ‰æœºè‚¥æ–™
   - ä½¿ç”¨æ•ˆæœæå‡25%
   - ç¬¦åˆç»¿è‰²å†œä¸šè¶‹åŠ¿
   - å®¢æˆ·å¤è´­ç‡85%

3. **æ™ºèƒ½ç§æ¤è®¾å¤‡**
   - è‡ªåŠ¨åŒ–çŒæº‰ç³»ç»Ÿ
   - ç²¾å‡†æ–½è‚¥è®¾å¤‡
   - é™ä½äººå·¥æˆæœ¬40%
   - æå‡ç§æ¤æ•ˆç‡30%

**ğŸ“ˆ å¸‚åœºè¡¨ç°æ•°æ®**
â€¢ äº§å“Aï¼šå¸‚åœºå æœ‰ç‡23%ï¼Œå¢é•¿ç‡+15%
â€¢ äº§å“Bï¼šå®¢æˆ·æ»¡æ„åº¦92%ï¼Œå¤è´­ç‡78%
â€¢ äº§å“Cï¼šæŠ€æœ¯é¢†å…ˆä¼˜åŠ¿ï¼Œåˆ©æ¶¦ç‡é«˜

**ğŸ’¡ æ¨èç†ç”±**
â€¢ ç¬¦åˆå®¢æˆ·ç§æ¤ç¯å¢ƒéœ€æ±‚
â€¢ å…·æœ‰æ˜æ˜¾çš„æŠ€æœ¯ä¼˜åŠ¿
â€¢ å¸‚åœºåé¦ˆç§¯æ
â€¢ æŠ•èµ„å›æŠ¥ç‡é«˜

**ğŸ¯ é”€å”®å»ºè®®**
â€¢ ä¼˜å…ˆæ¨èç»™å¤§å‹ç§æ¤æˆ·
â€¢ æä¾›è¯•ç”¨å’Œæ¼”ç¤ºæœåŠ¡
â€¢ åˆ¶å®šåˆ†æœŸä»˜æ¬¾æ–¹æ¡ˆ
â€¢ å»ºç«‹æŠ€æœ¯æ”¯æŒä½“ç³»

éœ€è¦æˆ‘ä¸ºæ‚¨åˆ¶å®šå…·ä½“çš„é”€å”®ç­–ç•¥å—ï¼Ÿ`,

                'å¸‚åœºè¶‹åŠ¿åˆ†æ': `ğŸ“ˆ **ç§ä¸šå¸‚åœºè¶‹åŠ¿æ·±åº¦åˆ†æ**

åŸºäºå¤§æ•°æ®åˆ†æå’Œè¡Œä¸šæ´å¯Ÿï¼Œå½“å‰ç§ä¸šå¸‚åœºå‘ˆç°ä»¥ä¸‹é‡è¦è¶‹åŠ¿ï¼š

**ğŸŒ± æŠ€æœ¯å‘å±•è¶‹åŠ¿**
1. **æ™ºèƒ½åŒ–ç§æ¤**
   - ç‰©è”ç½‘æŠ€æœ¯å¹¿æ³›åº”ç”¨
   - AIè¾…åŠ©å†³ç­–ç³»ç»Ÿæ™®åŠ
   - è‡ªåŠ¨åŒ–è®¾å¤‡éœ€æ±‚æ¿€å¢
   - é¢„è®¡å¹´å¢é•¿ç‡35%

2. **ç”Ÿç‰©æŠ€æœ¯çªç ´**
   - åŸºå› ç¼–è¾‘æŠ€æœ¯æˆç†Ÿ
   - æŠ—é€†æ€§å“ç§å¢å¤š
   - äº§é‡å’Œè´¨é‡åŒæå‡
   - ç ”å‘æŠ•å…¥æŒç»­å¢åŠ 

**ğŸŒ å¸‚åœºç¯å¢ƒå˜åŒ–**
1. **æ”¿ç­–æ”¯æŒåŠ›åº¦åŠ å¤§**
   - å†œä¸šç°ä»£åŒ–æ”¿ç­–
   - ç§ä¸šæŒ¯å…´è®¡åˆ’
   - ç»¿è‰²å†œä¸šå‘å±•
   - è¡¥è´´æ”¿ç­–ä¼˜åŒ–

2. **æ¶ˆè´¹éœ€æ±‚å‡çº§**
   - å“è´¨è¦æ±‚æé«˜
   - ç¯ä¿æ„è¯†å¢å¼º
   - ä¸ªæ€§åŒ–éœ€æ±‚å¢é•¿
   - æœåŠ¡è¦æ±‚æå‡

**ğŸ“Š ç«äº‰æ ¼å±€åˆ†æ**
â€¢ å¤´éƒ¨ä¼ä¸šé›†ä¸­åº¦æå‡
â€¢ æŠ€æœ¯åˆ›æ–°æˆä¸ºæ ¸å¿ƒç«äº‰åŠ›
â€¢ æœåŠ¡å·®å¼‚åŒ–æ—¥ç›Šé‡è¦
â€¢ å“ç‰Œå½±å“åŠ›æ˜¾è‘—å¢å¼º

**ğŸš€ å‘å±•æœºé‡**
â€¢ æ•°å­—åŒ–è½¬å‹çª—å£æœŸ
â€¢ æ–°å…´å¸‚åœºæ‹“å±•æœºä¼š
â€¢ äº§ä¸šé“¾æ•´åˆæœºé‡
â€¢ å›½é™…åˆä½œç©ºé—´æ‰©å¤§

**âš ï¸ æŒ‘æˆ˜ä¸é£é™©**
â€¢ æŠ€æœ¯æ›´æ–°æ¢ä»£å¿«
â€¢ å¸‚åœºç«äº‰åŠ å‰§
â€¢ æˆæœ¬å‹åŠ›å¢å¤§
â€¢ ç›‘ç®¡è¦æ±‚æé«˜

**ğŸ’¼ æˆ˜ç•¥å»ºè®®**
1. åŠ å¤§ç ”å‘æŠ•å…¥ï¼Œæå‡æŠ€æœ¯ä¼˜åŠ¿
2. å®Œå–„æœåŠ¡ä½“ç³»ï¼Œå¢å¼ºå®¢æˆ·ç²˜æ€§
3. æ‹“å±•æ–°å…´å¸‚åœºï¼Œæ‰©å¤§ä¸šåŠ¡è§„æ¨¡
4. åŠ å¼ºå“ç‰Œå»ºè®¾ï¼Œæå‡å¸‚åœºå½±å“åŠ›

æ‚¨å¸Œæœ›æˆ‘æ·±å…¥åˆ†æå“ªä¸ªå…·ä½“é¢†åŸŸï¼Ÿ`,

                'å®¢æˆ·æœåŠ¡ä¼˜åŒ–': `ğŸ§ **å®¢æˆ·æœåŠ¡ä¼˜åŒ–å‡çº§æ–¹æ¡ˆ**

åŸºäºå®¢æˆ·åé¦ˆå’ŒæœåŠ¡æ•°æ®åˆ†æï¼Œæˆ‘ä¸ºæ‚¨åˆ¶å®šä»¥ä¸‹ä¼˜åŒ–æ–¹æ¡ˆï¼š

**ğŸ“ æœåŠ¡æ¸ é“ä¼˜åŒ–**
1. **24å°æ—¶æ™ºèƒ½å®¢æœ**
   - AIæœºå™¨äººè‡ªåŠ¨åº”ç­”
   - å¸¸è§é—®é¢˜å³æ—¶è§£å†³
   - å¤æ‚é—®é¢˜è½¬äººå·¥
   - æœåŠ¡æ•ˆç‡æå‡80%

2. **å¤šæ¸ é“æœåŠ¡æ•´åˆ**
   - ç”µè¯ã€å¾®ä¿¡ã€é‚®ä»¶ç»Ÿä¸€
   - åœ¨çº¿å®¢æœå®æ—¶å“åº”
   - ç§»åŠ¨ç«¯æœåŠ¡ä¼˜åŒ–
   - æœåŠ¡ä¸€è‡´æ€§ä¿è¯

**ğŸ‘¥ æœåŠ¡å›¢é˜Ÿå»ºè®¾**
1. **ä¸“ä¸šåŸ¹è®­ä½“ç³»**
   - äº§å“çŸ¥è¯†åŸ¹è®­
   - æœåŠ¡æŠ€èƒ½æå‡
   - å®¢æˆ·æ²Ÿé€šæŠ€å·§
   - åº”æ€¥å¤„ç†èƒ½åŠ›

2. **ç»©æ•ˆè€ƒæ ¸ä¼˜åŒ–**
   - å®¢æˆ·æ»¡æ„åº¦æŒ‡æ ‡
   - å“åº”æ—¶é—´è¦æ±‚
   - é—®é¢˜è§£å†³ç‡
   - å®¢æˆ·ç•™å­˜ç‡

**ğŸ”„ æœåŠ¡æµç¨‹ä¼˜åŒ–**
1. **æ ‡å‡†åŒ–æœåŠ¡æµç¨‹**
   - é—®é¢˜åˆ†ç±»å¤„ç†
   - å“åº”æ—¶é—´æ ‡å‡†
   - å‡çº§å¤„ç†æœºåˆ¶
   - è´¨é‡ç›‘æ§ä½“ç³»

2. **ä¸ªæ€§åŒ–æœåŠ¡æ–¹æ¡ˆ**
   - VIPå®¢æˆ·ä¸“å±æœåŠ¡
   - å®šåˆ¶åŒ–è§£å†³æ–¹æ¡ˆ
   - å®šæœŸå›è®¿æœºåˆ¶
   - ä¸»åŠ¨å…³æ€€æœåŠ¡

**ğŸ“Š æœåŠ¡è´¨é‡ç›‘æ§**
â€¢ å®æ—¶æ»¡æ„åº¦ç›‘æ§
â€¢ æœåŠ¡æ•°æ®åˆ†æ
â€¢ å®¢æˆ·åé¦ˆæ”¶é›†
â€¢ æŒç»­æ”¹è¿›æœºåˆ¶

**ğŸ¯ é¢„æœŸæ•ˆæœ**
â€¢ å®¢æˆ·æ»¡æ„åº¦æå‡è‡³95%+
â€¢ æœåŠ¡å“åº”æ—¶é—´ç¼©çŸ­50%
â€¢ é—®é¢˜è§£å†³ç‡æå‡è‡³98%
â€¢ å®¢æˆ·æŠ•è¯‰ç‡é™ä½60%

**ğŸ’° æŠ•èµ„å›æŠ¥**
â€¢ å®¢æˆ·ç•™å­˜ç‡æå‡25%
â€¢ å®¢æˆ·æ¨èç‡å¢åŠ 40%
â€¢ æœåŠ¡æˆæœ¬é™ä½30%
â€¢ å“ç‰Œä»·å€¼æå‡20%

éœ€è¦æˆ‘ä¸ºæ‚¨åˆ¶å®šè¯¦ç»†çš„å®æ–½è®¡åˆ’å—ï¼Ÿ`,

                'æ•°æ®åˆ†ææŠ¥å‘Š': `ğŸ“Š **ç»¼åˆæ•°æ®åˆ†ææŠ¥å‘Š**

åŸºäºç³»ç»Ÿæ•°æ®åˆ†æï¼Œæˆ‘ä¸ºæ‚¨ç”Ÿæˆä»¥ä¸‹ç»¼åˆæŠ¥å‘Šï¼š

**ğŸ‘¥ å®¢æˆ·æ•°æ®åˆ†æ**
â€¢ æ€»å®¢æˆ·æ•°ï¼š1,247å®¶
â€¢ æ–°å¢å®¢æˆ·ï¼š156å®¶ï¼ˆæœ¬æœˆï¼‰
â€¢ æ´»è·ƒå®¢æˆ·ï¼š892å®¶ï¼ˆ71.5%ï¼‰
â€¢ VIPå®¢æˆ·ï¼š89å®¶ï¼ˆ7.1%ï¼‰
â€¢ å®¢æˆ·å¢é•¿ç‡ï¼š+12.3%

**ğŸ’° ä¸šåŠ¡æ•°æ®åˆ†æ**
â€¢ æ€»é”€å”®é¢ï¼šÂ¥2,847ä¸‡
â€¢ åŒæ¯”å¢é•¿ï¼š+18.7%
â€¢ å¹³å‡å®¢å•ä»·ï¼šÂ¥2.28ä¸‡
â€¢ å®¢æˆ·å¤è´­ç‡ï¼š76.3%
â€¢ åˆ©æ¶¦ç‡ï¼š23.8%

**ğŸ“ˆ è¶‹åŠ¿åˆ†æ**
1. **å®¢æˆ·å¢é•¿è¶‹åŠ¿**
   - æœˆåº¦å¢é•¿ç‡ç¨³å®šåœ¨10%+
   - æ–°å®¢æˆ·è´¨é‡æŒç»­æå‡
   - å®¢æˆ·ç”Ÿå‘½å‘¨æœŸå»¶é•¿
   - æµå¤±ç‡æ§åˆ¶åœ¨5%ä»¥ä¸‹

2. **äº§å“é”€å”®è¶‹åŠ¿**
   - æ ¸å¿ƒäº§å“é”€é‡å¢é•¿25%
   - æ–°äº§å“å¸‚åœºæ¥å—åº¦é«˜
   - å­£èŠ‚æ€§æ³¢åŠ¨æ˜æ˜¾
   - åŒºåŸŸå·®å¼‚æ˜¾è‘—

3. **æœåŠ¡æ•ˆæœåˆ†æ**
   - å®¢æˆ·æ»¡æ„åº¦89.2%
   - æœåŠ¡å“åº”æ—¶é—´2.3åˆ†é’Ÿ
   - é—®é¢˜è§£å†³ç‡96.8%
   - å®¢æˆ·æ¨èç‡78.5%

**ğŸ¯ å…³é”®æ´å¯Ÿ**
â€¢ åä¸œåœ°åŒºå®¢æˆ·ä»·å€¼æœ€é«˜
â€¢ ä¼ä¸šå®¢æˆ·è´¡çŒ®70%æ”¶å…¥
â€¢ çº¿ä¸Šæ¸ é“å¢é•¿è¿…é€Ÿ
â€¢ æœåŠ¡æ»¡æ„åº¦å½±å“å¤è´­ç‡

**âš ï¸ é£é™©é¢„è­¦**
â€¢ éƒ¨åˆ†äº§å“åº“å­˜ä¸è¶³
â€¢ ç«äº‰å¯¹æ‰‹ä»·æ ¼å‹åŠ›
â€¢ å®¢æˆ·æµå¤±é£é™©å¢åŠ 
â€¢ æˆæœ¬ä¸Šå‡å‹åŠ›

**ğŸ’¡ æ”¹è¿›å»ºè®®**
1. åŠ å¼ºé«˜ä»·å€¼å®¢æˆ·ç»´æŠ¤
2. ä¼˜åŒ–äº§å“åº“å­˜ç®¡ç†
3. æå‡æœåŠ¡å“åº”é€Ÿåº¦
4. æ‹“å±•æ–°å…´å¸‚åœºæ¸ é“

éœ€è¦æˆ‘è¯¦ç»†åˆ†ææŸä¸ªå…·ä½“æŒ‡æ ‡å—ï¼Ÿ`
            };
            
            // æŸ¥æ‰¾åŒ¹é…çš„å›å¤
            for (let key in responses) {
                if (userMessage.includes(key)) {
                    return responses[key];
                }
            }
            
            // é»˜è®¤å›å¤
            return `ğŸ¤– **AIæ™ºèƒ½åŠ©æ‰‹**

æ„Ÿè°¢æ‚¨çš„é—®é¢˜ï¼ä½œä¸ºä¸“ä¸šçš„AIæ™ºèƒ½åŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›ä»¥ä¸‹æœåŠ¡ï¼š

**ğŸ“Š æ•°æ®åˆ†ææœåŠ¡**
â€¢ å®¢æˆ·æ»¡æ„åº¦åˆ†æ
â€¢ é”€å”®ä¸šç»©åˆ†æ
â€¢ å¸‚åœºè¶‹åŠ¿åˆ†æ
â€¢ ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§

**ğŸ’¡ æ™ºèƒ½å»ºè®®æœåŠ¡**
â€¢ è¥é”€ç­–ç•¥å»ºè®®
â€¢ äº§å“æ¨èæ–¹æ¡ˆ
â€¢ å®¢æˆ·æœåŠ¡ä¼˜åŒ–
â€¢ ä¸šåŠ¡æµç¨‹æ”¹è¿›

**ğŸ¯ ä¸“ä¸šå’¨è¯¢æœåŠ¡**
â€¢ ç§ä¸šå¸‚åœºåˆ†æ
â€¢ æŠ€æœ¯å‘å±•è¶‹åŠ¿
â€¢ ç«äº‰ç¯å¢ƒåˆ†æ
â€¢ æŠ•èµ„å†³ç­–æ”¯æŒ

**ğŸ“ˆ æŠ¥å‘Šç”ŸæˆæœåŠ¡**
â€¢ æ•°æ®åˆ†ææŠ¥å‘Š
â€¢ å¸‚åœºè°ƒç ”æŠ¥å‘Š
â€¢ å®¢æˆ·åˆ†ææŠ¥å‘Š
â€¢ ä¸šåŠ¡å‘å±•æŠ¥å‘Š

è¯·å‘Šè¯‰æˆ‘æ‚¨å…·ä½“éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›ä¸“ä¸šã€è¯¦ç»†çš„å»ºè®®å’Œè§£å†³æ–¹æ¡ˆï¼`;
        }

        // å¤„ç†é”®ç›˜äº‹ä»¶
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // å¼€å§‹æ–°å¯¹è¯
        function startNewChat() {
            if (confirm('ç¡®å®šè¦å¼€å§‹æ–°å¯¹è¯å—ï¼Ÿå½“å‰å¯¹è¯è®°å½•å°†è¢«æ¸…ç©ºã€‚')) {
                chatHistory = [];
                currentChatId = Date.now();
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message ai-message">
                        <div class="message-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="welcome-content">
                                    <h6 class="welcome-title">
                                        <i class="bi bi-sparkles me-2"></i>æ¬¢è¿ä½¿ç”¨AIæ™ºèƒ½åŠ©æ‰‹
                                    </h6>
                                    <p>æ‚¨å¥½ï¼æˆ‘æ˜¯ä¸“é—¨ä¸ºç§ä¸šå®¢æˆ·ç®¡ç†ç³»ç»Ÿè®¾è®¡çš„AIæ™ºèƒ½åŠ©æ‰‹ã€‚</p>
                                    <div class="capabilities">
                                        <h6>æˆ‘å¯ä»¥å¸®åŠ©æ‚¨ï¼š</h6>
                                        <div class="capability-grid">
                                            <div class="capability-item">
                                                <i class="bi bi-graph-up"></i>
                                                <span>æ•°æ®åˆ†æ</span>
                                            </div>
                                            <div class="capability-item">
                                                <i class="bi bi-bullseye"></i>
                                                <span>è¥é”€ç­–ç•¥</span>
                                            </div>
                                            <div class="capability-item">
                                                <i class="bi bi-box-seam"></i>
                                                <span>äº§å“æ¨è</span>
                                            </div>
                                            <div class="capability-item">
                                                <i class="bi bi-headset"></i>
                                                <span>å®¢æˆ·æœåŠ¡</span>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="welcome-footer">è¯·éšæ—¶å‘æˆ‘æé—®ï¼Œæˆ‘ä¼šä¸ºæ‚¨æä¾›ä¸“ä¸šçš„å»ºè®®å’Œå¸®åŠ©ï¼</p>
                                </div>
                            </div>
                            <div class="message-time">åˆšåˆš</div>
                        </div>
                    </div>
                `;
                addToHistory('æ¬¢è¿ä½¿ç”¨AIæ™ºèƒ½åŠ©æ‰‹', 'ai', 'åˆšåˆš');
            }
        }

        // æ¸…ç©ºå¯¹è¯
        function clearChat() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰å¯¹è¯å—ï¼Ÿ')) {
                document.getElementById('chatMessages').innerHTML = '';
                chatHistory = [];
            }
        }

        // å¯¼å‡ºå¯¹è¯
        function exportChat() {
            if (chatHistory.length === 0) {
                alert('æ²¡æœ‰å¯¹è¯è®°å½•å¯ä»¥å¯¼å‡ºï¼');
                return;
            }
            
            let exportText = 'AIæ™ºèƒ½åŠ©æ‰‹å¯¹è¯è®°å½•\n';
            exportText += 'å¯¼å‡ºæ—¶é—´ï¼š' + new Date().toLocaleString() + '\n';
            exportText += '='.repeat(50) + '\n\n';
            
            chatHistory.forEach((msg, index) => {
                exportText += `[${msg.time}] ${msg.sender === 'user' ? 'ç”¨æˆ·' : 'AIåŠ©æ‰‹'}ï¼š\n`;
                exportText += msg.content + '\n\n';
            });
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AIå¯¹è¯è®°å½•_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // é™„ä»¶åŠŸèƒ½
        function attachFile() {
            alert('é™„ä»¶åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // è¯­éŸ³è¾“å…¥åŠŸèƒ½
        let isRecording = false;
        let mediaRecorder = null;
        let audioChunks = [];
        
        function startVoiceInput() {
            if (!isRecording) {
                startRecording();
            } else {
                stopRecording();
            }
        }
        
        // å¼€å§‹å½•éŸ³
        async function startRecording() {
            try {
                // æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    showVoiceError('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³å½•åˆ¶åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨Chromeã€Firefoxæˆ–Safariæµè§ˆå™¨');
                    return;
                }
                
                // æ£€æŸ¥HTTPSç¯å¢ƒ
                if (location.protocol !== 'https:' && location.hostname !== 'localhost') {
                    showVoiceError('è¯­éŸ³åŠŸèƒ½éœ€è¦åœ¨HTTPSç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œè¯·ä½¿ç”¨HTTPSè®¿é—®æˆ–æœ¬åœ°ç¯å¢ƒ');
                    return;
                }
                
                // æ˜¾ç¤ºæƒé™è¯·æ±‚æç¤º
                showPermissionRequest();
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    } 
                });
                
                // éšè—æƒé™è¯·æ±‚æç¤º
                hidePermissionRequest();
                
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm;codecs=opus'
                });
                audioChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    if (audioChunks.length > 0) {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        processVoiceInput(audioBlob);
                    } else {
                        showVoiceError('å½•éŸ³å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                    stream.getTracks().forEach(track => track.stop());
                };
                
                mediaRecorder.onerror = (event) => {
                    console.error('å½•éŸ³é”™è¯¯:', event.error);
                    showVoiceError('å½•éŸ³è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•');
                    stopRecording();
                };
                
                mediaRecorder.start(100); // æ¯100msæ”¶é›†ä¸€æ¬¡æ•°æ®
                isRecording = true;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const voiceBtn = document.querySelector('button[onclick="startVoiceInput()"]');
                voiceBtn.innerHTML = '<i class="bi bi-stop-circle"></i><span class="toolbar-label">åœæ­¢</span>';
                voiceBtn.title = 'åœæ­¢å½•éŸ³';
                voiceBtn.classList.add('recording');
                
                // æ˜¾ç¤ºå½•éŸ³çŠ¶æ€
                showRecordingIndicator();
                
                // è‡ªåŠ¨åœæ­¢å½•éŸ³ï¼ˆ15ç§’ï¼‰
                setTimeout(() => {
                    if (isRecording) {
                        stopRecording();
                    }
                }, 15000);
                
            } catch (error) {
                console.error('æ— æ³•è®¿é—®éº¦å…‹é£:', error);
                hidePermissionRequest();
                
                let errorMessage = 'æ— æ³•è®¿é—®éº¦å…‹é£';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage = 'éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å…è®¸è®¿é—®éº¦å…‹é£';
                } else if (error.name === 'NotFoundError') {
                    errorMessage = 'æœªæ‰¾åˆ°éº¦å…‹é£è®¾å¤‡ï¼Œè¯·æ£€æŸ¥è®¾å¤‡è¿æ¥';
                } else if (error.name === 'NotSupportedError') {
                    errorMessage = 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³å½•åˆ¶åŠŸèƒ½';
                } else if (error.name === 'NotReadableError') {
                    errorMessage = 'éº¦å…‹é£è¢«å…¶ä»–åº”ç”¨å ç”¨ï¼Œè¯·å…³é—­å…¶ä»–åº”ç”¨åé‡è¯•';
                }
                
                showVoiceError(errorMessage);
            }
        }
        
        // åœæ­¢å½•éŸ³
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const voiceBtn = document.querySelector('button[onclick="startVoiceInput()"]');
                voiceBtn.innerHTML = '<i class="bi bi-mic"></i><span class="toolbar-label">è¯­éŸ³</span>';
                voiceBtn.title = 'è¯­éŸ³è¾“å…¥';
                voiceBtn.classList.remove('recording');
                
                // éšè—å½•éŸ³çŠ¶æ€
                hideRecordingIndicator();
            }
        }
        
        // æ˜¾ç¤ºæƒé™è¯·æ±‚æç¤º
        function showPermissionRequest() {
            const messagesContainer = document.getElementById('chatMessages');
            const permissionDiv = document.createElement('div');
            permissionDiv.className = 'message ai-message permission-request';
            permissionDiv.id = 'permissionRequest';
            permissionDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-mic-fill text-warning"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="permission-request-content">
                            <i class="bi bi-mic-fill text-warning me-2"></i>
                            <span>æ­£åœ¨è¯·æ±‚éº¦å…‹é£æƒé™...</span>
                            <div class="permission-steps">
                                <p class="mb-1"><small>1. ç‚¹å‡»æµè§ˆå™¨åœ°å€æ çš„éº¦å…‹é£å›¾æ ‡</small></p>
                                <p class="mb-1"><small>2. é€‰æ‹©"å…è®¸"è®¿é—®éº¦å…‹é£</small></p>
                                <p class="mb-0"><small>3. é‡æ–°ç‚¹å‡»è¯­éŸ³æŒ‰é’®å¼€å§‹å½•éŸ³</small></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(permissionDiv);
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                scrollToBottom();
            }, 50);
        }
        
        // éšè—æƒé™è¯·æ±‚æç¤º
        function hidePermissionRequest() {
            const permissionRequest = document.getElementById('permissionRequest');
            if (permissionRequest) {
                permissionRequest.remove();
            }
        }
        
        // æ˜¾ç¤ºè¯­éŸ³é”™è¯¯æç¤º
        function showVoiceError(message) {
            const messagesContainer = document.getElementById('chatMessages');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'message ai-message voice-error';
            errorDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-exclamation-triangle-fill text-danger"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="voice-error-content">
                            <i class="bi bi-exclamation-triangle-fill text-danger me-2"></i>
                            <span class="error-message">${message}</span>
                            <div class="error-solutions mt-2">
                                <h6 class="mb-2">è§£å†³æ–¹æ¡ˆï¼š</h6>
                                <ul class="mb-2">
                                    <li>æ£€æŸ¥æµè§ˆå™¨åœ°å€æ æ˜¯å¦æœ‰éº¦å…‹é£å›¾æ ‡</li>
                                    <li>ç‚¹å‡»éº¦å…‹é£å›¾æ ‡é€‰æ‹©"å…è®¸"</li>
                                    <li>åˆ·æ–°é¡µé¢åé‡è¯•</li>
                                    <li>ç¡®ä¿ä½¿ç”¨Chromeã€Firefoxæˆ–Safariæµè§ˆå™¨</li>
                                </ul>
                                <button class="btn btn-outline-primary btn-sm" onclick="retryVoiceInput()">
                                    <i class="bi bi-arrow-clockwise"></i> é‡è¯•
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(errorDiv);
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                scrollToBottom();
            }, 50);
        }
        
        // é‡è¯•è¯­éŸ³è¾“å…¥
        function retryVoiceInput() {
            // ç§»é™¤é”™è¯¯æç¤º
            const errorDiv = document.querySelector('.voice-error');
            if (errorDiv) {
                errorDiv.remove();
            }
            
            // é‡æ–°å¼€å§‹è¯­éŸ³è¾“å…¥
            setTimeout(() => {
                startVoiceInput();
            }, 500);
        }
        
        // æ˜¾ç¤ºè¯­éŸ³ä½¿ç”¨æŒ‡å—
        function showVoiceGuide() {
            const messagesContainer = document.getElementById('chatMessages');
            const guideDiv = document.createElement('div');
            guideDiv.className = 'message ai-message voice-guide';
            guideDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-info-circle-fill text-info"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="voice-guide-content">
                            <h6 class="mb-3">
                                <i class="bi bi-mic-fill text-primary me-2"></i>
                                è¯­éŸ³åŠŸèƒ½ä½¿ç”¨æŒ‡å—
                            </h6>
                            
                            <div class="guide-section">
                                <h6 class="text-primary">ğŸ¤ å¦‚ä½•ä½¿ç”¨è¯­éŸ³è¾“å…¥</h6>
                                <ol class="mb-3">
                                    <li>ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹å½•éŸ³</li>
                                    <li>å…è®¸æµè§ˆå™¨è®¿é—®éº¦å…‹é£æƒé™</li>
                                    <li>æ¸…æ™°åœ°è¯´å‡ºæ‚¨çš„é—®é¢˜</li>
                                    <li>ç‚¹å‡»åœæ­¢æŒ‰é’®æˆ–ç­‰å¾…è‡ªåŠ¨åœæ­¢</li>
                                    <li>ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¹¶å‘é€æ¶ˆæ¯</li>
                                </ol>
                            </div>
                            
                            <div class="guide-section">
                                <h6 class="text-success">ğŸ”Š è¯­éŸ³æ’­æ”¾åŠŸèƒ½</h6>
                                <ul class="mb-3">
                                    <li>AIå›å¤åï¼Œæ‚¬åœæ¶ˆæ¯æ˜¾ç¤ºæ“ä½œæŒ‰é’®</li>
                                    <li>ç‚¹å‡»æ’­æ”¾æŒ‰é’®æ”¶å¬AIå›å¤</li>
                                    <li>æ”¯æŒä¸­æ–‡è¯­éŸ³åˆæˆ</li>
                                    <li>å¯è°ƒèŠ‚è¯­é€Ÿå’ŒéŸ³é‡</li>
                                </ul>
                            </div>
                            
                            <div class="guide-section">
                                <h6 class="text-warning">âš ï¸ æ³¨æ„äº‹é¡¹</h6>
                                <ul class="mb-3">
                                    <li>éœ€è¦HTTPSç¯å¢ƒæˆ–æœ¬åœ°è®¿é—®</li>
                                    <li>å»ºè®®ä½¿ç”¨Chromeã€Firefoxæˆ–Safariæµè§ˆå™¨</li>
                                    <li>ç¡®ä¿éº¦å…‹é£è®¾å¤‡æ­£å¸¸å·¥ä½œ</li>
                                    <li>å½•éŸ³æ—¶é—´æœ€é•¿15ç§’</li>
                                    <li>è¯´è¯æ¸…æ™°ï¼Œé¿å…èƒŒæ™¯å™ªéŸ³</li>
                                </ul>
                            </div>
                            
                            <div class="guide-section">
                                <h6 class="text-info">ğŸ’¡ æ”¯æŒçš„é—®é¢˜ç±»å‹</h6>
                                <div class="supported-questions">
                                    <span class="badge bg-primary me-1">å®¢æˆ·æ»¡æ„åº¦åˆ†æ</span>
                                    <span class="badge bg-success me-1">è¥é”€ç­–ç•¥å»ºè®®</span>
                                    <span class="badge bg-warning me-1">äº§å“æ¨è</span>
                                    <span class="badge bg-info me-1">å¸‚åœºè¶‹åŠ¿åˆ†æ</span>
                                    <span class="badge bg-secondary me-1">å®¢æˆ·æœåŠ¡ä¼˜åŒ–</span>
                                    <span class="badge bg-dark me-1">æ•°æ®åˆ†ææŠ¥å‘Š</span>
                                </div>
                            </div>
                            
                            <div class="guide-actions mt-3">
                                <button class="btn btn-primary btn-sm" onclick="startVoiceInput()">
                                    <i class="bi bi-mic"></i> ç«‹å³ä½“éªŒ
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="closeVoiceGuide()">
                                    <i class="bi bi-x"></i> å…³é—­æŒ‡å—
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(guideDiv);
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                scrollToBottom();
            }, 50);
        }
        
        // å…³é—­è¯­éŸ³æŒ‡å—
        function closeVoiceGuide() {
            const guideDiv = document.querySelector('.voice-guide');
            if (guideDiv) {
                guideDiv.remove();
            }
        }
        
        // æ˜¾ç¤ºå½•éŸ³çŠ¶æ€æŒ‡ç¤ºå™¨
        function showRecordingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const recordingDiv = document.createElement('div');
            recordingDiv.className = 'message user-message recording-indicator';
            recordingDiv.id = 'recordingIndicator';
            recordingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-mic-fill text-danger"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="recording-animation">
                            <i class="bi bi-mic-fill text-danger"></i>
                            <span class="recording-text">æ­£åœ¨å½•éŸ³ä¸­...</span>
                            <div class="recording-dots">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(recordingDiv);
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                scrollToBottom();
            }, 50);
        }
        
        // éšè—å½•éŸ³çŠ¶æ€æŒ‡ç¤ºå™¨
        function hideRecordingIndicator() {
            const recordingIndicator = document.getElementById('recordingIndicator');
            if (recordingIndicator) {
                recordingIndicator.remove();
            }
        }
        
        // å¤„ç†è¯­éŸ³è¾“å…¥
        function processVoiceInput(audioBlob) {
            // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«
            const voiceMessages = [
                'å®¢æˆ·æ»¡æ„åº¦åˆ†æ',
                'è¥é”€ç­–ç•¥å»ºè®®', 
                'äº§å“æ¨è',
                'å¸‚åœºè¶‹åŠ¿åˆ†æ',
                'å®¢æˆ·æœåŠ¡ä¼˜åŒ–',
                'æ•°æ®åˆ†ææŠ¥å‘Š',
                'å¸®æˆ‘åˆ†æä¸€ä¸‹æœ€è¿‘çš„å®¢æˆ·æ•°æ®',
                'æœ‰ä»€ä¹ˆå¥½çš„è¥é”€å»ºè®®å—',
                'æ¨èä¸€äº›é€‚åˆçš„äº§å“',
                'å¸‚åœºæƒ…å†µæ€ä¹ˆæ ·'
            ];
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªè¯­éŸ³æ¶ˆæ¯
            const randomMessage = voiceMessages[Math.floor(Math.random() * voiceMessages.length)];
            
            // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
            addMessage(randomMessage, 'user');
            
            // æ˜¾ç¤ºè¯­éŸ³è¯†åˆ«ç»“æœ
            showVoiceRecognitionResult(randomMessage);
            
            // æ˜¾ç¤ºæ­£åœ¨è¾“å…¥çŠ¶æ€
            showTypingIndicator();
            
            // ç”ŸæˆAIå›å¤
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = generateAIResponse(randomMessage);
                addMessage(aiResponse, 'ai');
                
                // è‡ªåŠ¨æ’­æ”¾AIå›å¤ï¼ˆå¯é€‰ï¼‰
                // speakText(aiResponse);
            }, 1500 + Math.random() * 1000);
        }
        
        // æ˜¾ç¤ºè¯­éŸ³è¯†åˆ«ç»“æœ
        function showVoiceRecognitionResult(text) {
            const messagesContainer = document.getElementById('chatMessages');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'message user-message voice-result';
            resultDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-mic-fill text-primary"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="voice-recognition-result">
                            <i class="bi bi-mic-fill text-primary me-2"></i>
                            <span class="voice-text">è¯­éŸ³è¯†åˆ«ï¼š${text}</span>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(resultDiv);
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                scrollToBottom();
            }, 50);
        }
        
        // è¯­éŸ³æ’­æ”¾åŠŸèƒ½
        function speakText(text) {
            if ('speechSynthesis' in window) {
                // åœæ­¢ä¹‹å‰çš„æ’­æ”¾
                speechSynthesis.cancel();
                
                // åˆ›å»ºè¯­éŸ³åˆæˆ
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.9;
                utterance.pitch = 1.0;
                utterance.volume = 0.8;
                
                // æ’­æ”¾è¯­éŸ³
                speechSynthesis.speak(utterance);
                
                // æ˜¾ç¤ºæ’­æ”¾çŠ¶æ€
                showSpeakingIndicator();
                
                // æ’­æ”¾å®Œæˆåéšè—æŒ‡ç¤ºå™¨
                utterance.onend = () => {
                    hideSpeakingIndicator();
                };
            }
        }
        
        // æ˜¾ç¤ºè¯­éŸ³æ’­æ”¾çŠ¶æ€
        function showSpeakingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const speakingDiv = document.createElement('div');
            speakingDiv.className = 'message ai-message speaking-indicator';
            speakingDiv.id = 'speakingIndicator';
            speakingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-volume-up-fill text-success"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="speaking-animation">
                            <i class="bi bi-volume-up-fill text-success"></i>
                            <span class="speaking-text">æ­£åœ¨æ’­æ”¾è¯­éŸ³å›å¤...</span>
                            <div class="speaking-waves">
                                <span></span>
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(speakingDiv);
            
            // å»¶è¿Ÿæ»šåŠ¨ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
            setTimeout(() => {
                scrollToBottom();
            }, 50);
        }
        
        // éšè—è¯­éŸ³æ’­æ”¾çŠ¶æ€
        function hideSpeakingIndicator() {
            const speakingIndicator = document.getElementById('speakingIndicator');
            if (speakingIndicator) {
                speakingIndicator.remove();
            }
        }

        // è¡¨æƒ…åŠŸèƒ½
        function toggleEmoji() {
            alert('è¡¨æƒ…åŠŸèƒ½å¼€å‘ä¸­...');
        }
        
        // æµ‹è¯•æ»šåŠ¨åŠŸèƒ½
        function testScroll() {
            console.log('å¼€å§‹æµ‹è¯•æ»šåŠ¨åŠŸèƒ½...');
            
            // æ·»åŠ æµ‹è¯•æ¶ˆæ¯
            addMessage('è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ¶ˆæ¯ï¼Œç”¨äºéªŒè¯æ»šåŠ¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚', 'user');
            
            setTimeout(() => {
                addMessage('è¿™æ˜¯AIçš„æµ‹è¯•å›å¤ï¼Œç”¨äºéªŒè¯æ»šåŠ¨åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚', 'ai');
            }, 1000);
            
            // å¼ºåˆ¶æ»šåŠ¨æµ‹è¯•
            setTimeout(() => {
                console.log('æ‰§è¡Œå¼ºåˆ¶æ»šåŠ¨æµ‹è¯•...');
                forceScrollToBottom();
            }, 2000);
        }

        // åˆ‡æ¢å¿«é€Ÿæ“ä½œæŠ˜å çŠ¶æ€
        function toggleQuickActions() {
            const content = document.getElementById('quickActionsContent');
            const toggleIcon = document.getElementById('quickActionsToggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggleIcon.className = 'bi bi-chevron-down toggle-icon';
            } else {
                content.style.display = 'none';
                toggleIcon.className = 'bi bi-chevron-right toggle-icon';
            }
        }
    </script>
</body>
</html>