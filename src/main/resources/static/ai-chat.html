<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI智能聊天 - AI客户管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/ai-customer/css/common.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="page-title">
                <i class="bi bi-chat-dots"></i> AI智能聊天
            </div>
            <a href="/ai-customer/" class="back-home-btn">
                <i class="bi bi-house-fill"></i> 返回首页
            </a>
        </div>
        
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-3">
                <div class="card h-100">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">AI助手</h6>
                            <button class="btn btn-outline-primary btn-sm" onclick="startNewChat()">
                                <i class="bi bi-plus"></i> 新对话
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- 快速操作 -->
                        <div class="mb-3">
                            <h6 class="text-muted mb-0">快速操作</h6>
                        </div>
                        <div class="quick-actions">
                            <button class="quick-action-btn" onclick="sendQuickMessage('客户满意度分析')">
                                <i class="bi bi-graph-up"></i>
                                <span>客户满意度</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('营销策略建议')">
                                <i class="bi bi-bullseye"></i>
                                <span>营销策略</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('产品推荐')">
                                <i class="bi bi-box-seam"></i>
                                <span>产品推荐</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('市场趋势分析')">
                                <i class="bi bi-trending-up"></i>
                                <span>市场趋势</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('客户服务优化')">
                                <i class="bi bi-headset"></i>
                                <span>服务优化</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('数据分析报告')">
                                <i class="bi bi-file-earmark-bar-graph"></i>
                                <span>数据分析</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 主聊天区域 -->
            <div class="col-md-9">
                <div class="card h-100">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <div class="ai-avatar me-3">
                                <i class="bi bi-robot"></i>
                            </div>
                            <div>
                                <h6 class="mb-0">AI智能助手</h6>
                                <small class="text-muted">在线 · 专业种业顾问</small>
                            </div>
                        </div>
                    </div>
                    <div class="card-body chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <!-- 欢迎消息 -->
                            <div class="message ai-message">
                                <div class="message-avatar">
                                    <i class="bi bi-robot"></i>
                                </div>
                                <div class="message-content">
                                    <div class="message-bubble">
                                        <p>您好！我是AI智能助手，专门为种业客户管理系统提供专业服务。</p>
                                        <p>我可以帮助您：</p>
                                        <ul>
                                            <li>分析客户数据和市场趋势</li>
                                            <li>提供营销策略建议</li>
                                            <li>推荐合适的产品和服务</li>
                                            <li>解答业务相关问题</li>
                                        </ul>
                                        <p>请随时向我提问，我会尽力为您提供帮助。</p>
                                    </div>
                                    <div class="message-time">刚刚</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 输入区域 -->
                        <div class="chat-input">
                            <div class="input-group">
                                <button class="btn btn-outline-secondary" type="button" onclick="attachFile()">
                                    <i class="bi bi-paperclip"></i>
                                </button>
                                <button class="btn btn-outline-secondary" type="button" onclick="startVoiceInput()">
                                    <i class="bi bi-mic"></i>
                                </button>
                                <textarea class="form-control" id="messageInput" placeholder="请输入您的问题..." rows="2" onkeypress="handleKeyPress(event)"></textarea>
                                <button class="btn btn-primary" type="button" onclick="sendMessage()">
                                    <i class="bi bi-send"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let chatHistory = [];
        let isTyping = false;

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 聚焦到输入框
            document.getElementById('messageInput').focus();
        });

        // 发送消息
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // 添加用户消息
            addMessage(message, 'user');
            
            // 清空输入框
            input.value = '';
            
            // 模拟AI回复
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'ai');
            }, 1000);
        }

        // 发送快速消息
        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        // 添加消息到聊天界面
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${content}</p>
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                    <div class="message-avatar">
                        <i class="bi bi-person-fill"></i>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="bi bi-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${content}</p>
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // 保存到聊天历史
            chatHistory.push({
                content: content,
                sender: sender,
                time: time
            });
        }

        // 生成AI回复
        function generateAIResponse(userMessage) {
            const responses = {
                '客户满意度分析': '根据您的要求，我来为您分析客户满意度数据。从最近的数据来看，整体满意度为89%，其中产品满意度92%，服务满意度85%。建议重点关注服务环节的改进。',
                '营销策略建议': '基于当前市场情况，我建议采用以下营销策略：1. 数字化营销渠道拓展 2. 客户细分精准营销 3. 产品差异化定位 4. 客户关系维护加强。您希望我详细分析哪个方面？',
                '产品推荐': '根据您的客户画像和需求，我推荐以下产品组合：1. 抗病性强的水稻品种 2. 高效肥料产品 3. 智能种植设备。这些产品在您的目标市场表现优异。',
                '市场趋势分析': '当前种业市场呈现以下趋势：1. 智能化种植需求增长 2. 环保型产品受青睐 3. 线上销售渠道快速发展 4. 客户对服务质量要求提高。建议提前布局相关领域。',
                '客户服务优化': '客户服务优化建议：1. 建立24小时客服热线 2. 提供在线技术支持 3. 定期客户回访 4. 建立客户反馈机制 5. 培训客服人员专业技能。',
                '数据分析报告': '数据分析报告已生成，包含：1. 客户增长趋势 2. 产品销售分析 3. 市场占有率变化 4. 客户满意度趋势 5. 收入结构分析。需要我详细解释某个指标吗？'
            };
            
            // 查找匹配的回复
            for (let key in responses) {
                if (userMessage.includes(key)) {
                    return responses[key];
                }
            }
            
            // 默认回复
            return '感谢您的问题！作为AI智能助手，我可以帮助您分析客户数据、提供营销建议、推荐产品等。请告诉我您具体需要什么帮助，我会为您提供专业的建议。';
        }

        // 处理键盘事件
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // 开始新对话
        function startNewChat() {
            if (confirm('确定要开始新对话吗？当前对话记录将被清空。')) {
                chatHistory = [];
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message ai-message">
                        <div class="message-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <p>您好！我是AI智能助手，专门为种业客户管理系统提供专业服务。</p>
                                <p>我可以帮助您：</p>
                                <ul>
                                    <li>分析客户数据和市场趋势</li>
                                    <li>提供营销策略建议</li>
                                    <li>推荐合适的产品和服务</li>
                                    <li>解答业务相关问题</li>
                                </ul>
                                <p>请随时向我提问，我会尽力为您提供帮助。</p>
                            </div>
                            <div class="message-time">刚刚</div>
                        </div>
                    </div>
                `;
            }
        }

        // 附件功能
        function attachFile() {
            alert('附件功能开发中...');
        }

        // 语音输入功能
        function startVoiceInput() {
            alert('语音输入功能开发中...');
        }
    </script>
</body>
</html>