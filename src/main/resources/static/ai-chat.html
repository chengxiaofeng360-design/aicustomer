<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI智能聊天 - AI客户管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/ai-customer/css/common.css" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="page-title">
                <i class="bi bi-chat-dots"></i> AI智能聊天
            </div>
            <a href="/ai-customer/" class="back-home-btn">
                <i class="bi bi-house-fill"></i> 返回首页
            </a>
        </div>
        
        <!-- 聊天主容器 -->
        <div class="chat-main-container">
            <!-- 侧边栏 -->
            <div class="chat-sidebar">
                <div class="sidebar-header">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0 text-white">
                            <i class="bi bi-robot me-2"></i>AI助手
                        </h5>
                        <button class="btn btn-light btn-sm" onclick="startNewChat()" title="新对话">
                            <i class="bi bi-plus"></i>
                        </button>
                    </div>
                    <div class="ai-status">
                        <div class="status-indicator online"></div>
                        <span class="status-text">在线服务中</span>
                    </div>
                </div>
                
                <!-- 当前对话 -->
                <div class="current-chat-section">
                    <h6 class="text-white mb-3">
                        <i class="bi bi-chat-dots me-2"></i>当前对话
                    </h6>
                    <div class="current-chat-info">
                        <div class="current-chat-item active">
                            <i class="bi bi-chat-square-text"></i>
                            <span>与AI助手的对话</span>
                        </div>
                    </div>
                </div>
                
                <!-- 对话历史 -->
                <div class="chat-history">
                    <h6 class="text-white mb-3">
                        <i class="bi bi-clock-history me-2"></i>对话历史
                    </h6>
                    <div class="history-list" id="historyList">
                        <div class="history-item">
                            <i class="bi bi-chat-dots"></i>
                            <span>历史对话 1</span>
                        </div>
                        <div class="history-item">
                            <i class="bi bi-chat-dots"></i>
                            <span>历史对话 2</span>
                        </div>
                        <div class="history-item">
                            <i class="bi bi-chat-dots"></i>
                            <span>历史对话 3</span>
                        </div>
                    </div>
                </div>
                
                <!-- 快速操作 -->
                <div class="quick-actions-sidebar">
                    <div class="quick-actions-header" onclick="toggleQuickActions()">
                        <h6 class="text-white mb-0">
                            <i class="bi bi-lightning me-2"></i>快速操作
                        </h6>
                        <i class="bi bi-chevron-down toggle-icon" id="quickActionsToggle"></i>
                    </div>
                    <div class="quick-actions-content" id="quickActionsContent">
                        <div class="quick-actions-grid">
                            <button class="quick-action-btn" onclick="sendQuickMessage('客户满意度分析')">
                                <i class="bi bi-graph-up"></i>
                                <span>客户满意度</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('营销策略建议')">
                                <i class="bi bi-bullseye"></i>
                                <span>营销策略</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('产品推荐')">
                                <i class="bi bi-box-seam"></i>
                                <span>产品推荐</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('市场趋势分析')">
                                <i class="bi bi-trending-up"></i>
                                <span>市场趋势</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('客户服务优化')">
                                <i class="bi bi-headset"></i>
                                <span>服务优化</span>
                            </button>
                            <button class="quick-action-btn" onclick="sendQuickMessage('数据分析报告')">
                                <i class="bi bi-file-earmark-bar-graph"></i>
                                <span>数据分析</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 主聊天区域 -->
            <div class="chat-main-area">
                <!-- 聊天头部 -->
                <div class="chat-header">
                    <div class="chat-title">
                        <div class="ai-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div>
                            <h6 class="mb-0">AI智能助手</h6>
                            <small class="text-muted">专业种业顾问 · 24小时在线</small>
                        </div>
                    </div>
                    <div class="chat-actions">
                        <button class="btn btn-outline-secondary btn-sm" onclick="clearChat()" title="清空对话">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="exportChat()" title="导出对话">
                            <i class="bi bi-download"></i>
                        </button>
                    </div>
                </div>
                
                <!-- 消息容器 -->
                <div class="chat-messages-container">
                    <div class="chat-messages" id="chatMessages">
                        <!-- 欢迎消息 -->
                        <div class="message ai-message">
                            <div class="message-avatar">
                                <i class="bi bi-robot"></i>
                            </div>
                            <div class="message-content">
                                <div class="message-bubble">
                                    <div class="welcome-content">
                                        <h6 class="welcome-title">
                                            <i class="bi bi-sparkles me-2"></i>欢迎使用AI智能助手
                                        </h6>
                                        <p>您好！我是专门为种业客户管理系统设计的AI智能助手。</p>
                                        <div class="capabilities">
                                            <h6>我可以帮助您：</h6>
                                            <div class="capability-grid">
                                                <div class="capability-item">
                                                    <i class="bi bi-graph-up"></i>
                                                    <span>数据分析</span>
                                                </div>
                                                <div class="capability-item">
                                                    <i class="bi bi-bullseye"></i>
                                                    <span>营销策略</span>
                                                </div>
                                                <div class="capability-item">
                                                    <i class="bi bi-box-seam"></i>
                                                    <span>产品推荐</span>
                                                </div>
                                                <div class="capability-item">
                                                    <i class="bi bi-headset"></i>
                                                    <span>客户服务</span>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="welcome-footer">请随时向我提问，我会为您提供专业的建议和帮助！</p>
                                    </div>
                                </div>
                                <div class="message-time">刚刚</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 输入区域 -->
                <div class="chat-input-area">
                    <div class="input-actions">
                        <button class="btn btn-outline-secondary btn-sm" onclick="attachFile()" title="附件">
                            <i class="bi bi-paperclip"></i>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="startVoiceInput()" title="语音输入">
                            <i class="bi bi-mic"></i>
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="toggleEmoji()" title="表情">
                            <i class="bi bi-emoji-smile"></i>
                        </button>
                    </div>
                    <div class="input-container">
                        <textarea 
                            class="form-control chat-input" 
                            id="messageInput" 
                            placeholder="请输入您的问题..." 
                            rows="1"
                            onkeypress="handleKeyPress(event)"
                            oninput="autoResize(this)"
                        ></textarea>
                        <button class="btn btn-primary send-btn" onclick="sendMessage()" id="sendBtn">
                            <i class="bi bi-send"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let chatHistory = [];
        let isTyping = false;
        let currentChatId = Date.now();

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 聚焦到输入框
            document.getElementById('messageInput').focus();
            
            // 初始化聊天界面
            initializeChat();
        });

        // 初始化聊天界面
        function initializeChat() {
            // 添加欢迎消息到历史记录
            addToHistory('欢迎使用AI智能助手', 'ai', '刚刚');
        }

        // 发送消息
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // 添加用户消息
            addMessage(message, 'user');
            
            // 清空输入框并重置高度
            input.value = '';
            autoResize(input);
            
            // 显示正在输入状态
            showTypingIndicator();
            
            // 模拟AI回复
            setTimeout(() => {
                hideTypingIndicator();
                const aiResponse = generateAIResponse(message);
                addMessage(aiResponse, 'ai');
            }, 1500 + Math.random() * 1000);
        }

        // 发送快速消息
        function sendQuickMessage(message) {
            document.getElementById('messageInput').value = message;
            sendMessage();
        }

        // 添加消息到聊天界面
        function addMessage(content, sender) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const time = new Date().toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${content}</p>
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                    <div class="message-avatar">
                        <i class="bi bi-person-fill"></i>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="bi bi-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-bubble">
                            <p>${content}</p>
                        </div>
                        <div class="message-time">${time}</div>
                    </div>
                `;
            }
            
            messagesContainer.appendChild(messageDiv);
            scrollToBottom();
            
            // 保存到聊天历史
            addToHistory(content, sender, time);
        }

        // 添加到历史记录
        function addToHistory(content, sender, time) {
            chatHistory.push({
                content: content,
                sender: sender,
                time: time,
                chatId: currentChatId
            });
        }

        // 显示正在输入状态
        function showTypingIndicator() {
            const messagesContainer = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="bi bi-robot"></i>
                </div>
                <div class="message-content">
                    <div class="message-bubble">
                        <div class="typing-dots">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            `;
            messagesContainer.appendChild(typingDiv);
            scrollToBottom();
        }

        // 隐藏正在输入状态
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // 滚动到底部
        function scrollToBottom() {
            const messagesContainer = document.getElementById('chatMessages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        // 自动调整输入框高度
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';
        }

        // 生成AI回复
        function generateAIResponse(userMessage) {
            const responses = {
                '客户满意度分析': '根据您的要求，我来为您分析客户满意度数据。从最近的数据来看，整体满意度为89%，其中产品满意度92%，服务满意度85%。建议重点关注服务环节的改进。',
                '营销策略建议': '基于当前市场情况，我建议采用以下营销策略：1. 数字化营销渠道拓展 2. 客户细分精准营销 3. 产品差异化定位 4. 客户关系维护加强。您希望我详细分析哪个方面？',
                '产品推荐': '根据您的客户画像和需求，我推荐以下产品组合：1. 抗病性强的水稻品种 2. 高效肥料产品 3. 智能种植设备。这些产品在您的目标市场表现优异。',
                '市场趋势分析': '当前种业市场呈现以下趋势：1. 智能化种植需求增长 2. 环保型产品受青睐 3. 线上销售渠道快速发展 4. 客户对服务质量要求提高。建议提前布局相关领域。',
                '客户服务优化': '客户服务优化建议：1. 建立24小时客服热线 2. 提供在线技术支持 3. 定期客户回访 4. 建立客户反馈机制 5. 培训客服人员专业技能。',
                '数据分析报告': '数据分析报告已生成，包含：1. 客户增长趋势 2. 产品销售分析 3. 市场占有率变化 4. 客户满意度趋势 5. 收入结构分析。需要我详细解释某个指标吗？'
            };
            
            // 查找匹配的回复
            for (let key in responses) {
                if (userMessage.includes(key)) {
                    return responses[key];
                }
            }
            
            // 默认回复
            return '感谢您的问题！作为AI智能助手，我可以帮助您分析客户数据、提供营销建议、推荐产品等。请告诉我您具体需要什么帮助，我会为您提供专业的建议。';
        }

        // 处理键盘事件
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // 开始新对话
        function startNewChat() {
            if (confirm('确定要开始新对话吗？当前对话记录将被清空。')) {
                chatHistory = [];
                currentChatId = Date.now();
                document.getElementById('chatMessages').innerHTML = `
                    <div class="message ai-message">
                        <div class="message-avatar">
                            <i class="bi bi-robot"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-bubble">
                                <div class="welcome-content">
                                    <h6 class="welcome-title">
                                        <i class="bi bi-sparkles me-2"></i>欢迎使用AI智能助手
                                    </h6>
                                    <p>您好！我是专门为种业客户管理系统设计的AI智能助手。</p>
                                    <div class="capabilities">
                                        <h6>我可以帮助您：</h6>
                                        <div class="capability-grid">
                                            <div class="capability-item">
                                                <i class="bi bi-graph-up"></i>
                                                <span>数据分析</span>
                                            </div>
                                            <div class="capability-item">
                                                <i class="bi bi-bullseye"></i>
                                                <span>营销策略</span>
                                            </div>
                                            <div class="capability-item">
                                                <i class="bi bi-box-seam"></i>
                                                <span>产品推荐</span>
                                            </div>
                                            <div class="capability-item">
                                                <i class="bi bi-headset"></i>
                                                <span>客户服务</span>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="welcome-footer">请随时向我提问，我会为您提供专业的建议和帮助！</p>
                                </div>
                            </div>
                            <div class="message-time">刚刚</div>
                        </div>
                    </div>
                `;
                addToHistory('欢迎使用AI智能助手', 'ai', '刚刚');
            }
        }

        // 清空对话
        function clearChat() {
            if (confirm('确定要清空当前对话吗？')) {
                document.getElementById('chatMessages').innerHTML = '';
                chatHistory = [];
            }
        }

        // 导出对话
        function exportChat() {
            if (chatHistory.length === 0) {
                alert('没有对话记录可以导出！');
                return;
            }
            
            let exportText = 'AI智能助手对话记录\n';
            exportText += '导出时间：' + new Date().toLocaleString() + '\n';
            exportText += '='.repeat(50) + '\n\n';
            
            chatHistory.forEach((msg, index) => {
                exportText += `[${msg.time}] ${msg.sender === 'user' ? '用户' : 'AI助手'}：\n`;
                exportText += msg.content + '\n\n';
            });
            
            // 创建下载链接
            const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `AI对话记录_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 附件功能
        function attachFile() {
            alert('附件功能开发中...');
        }

        // 语音输入功能
        function startVoiceInput() {
            alert('语音输入功能开发中...');
        }

        // 表情功能
        function toggleEmoji() {
            alert('表情功能开发中...');
        }

        // 切换快速操作折叠状态
        function toggleQuickActions() {
            const content = document.getElementById('quickActionsContent');
            const toggleIcon = document.getElementById('quickActionsToggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                toggleIcon.className = 'bi bi-chevron-down toggle-icon';
            } else {
                content.style.display = 'none';
                toggleIcon.className = 'bi bi-chevron-right toggle-icon';
            }
        }
    </script>
</body>
</html>