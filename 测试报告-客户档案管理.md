# å®¢æˆ·æ¡£æ¡ˆç®¡ç†å¢åˆ æ”¹æŸ¥æµ‹è¯•æŠ¥å‘Š

## ä¸€ã€ä»£ç å®ç°æ£€æŸ¥

### âœ… 1. Controllerå±‚æ£€æŸ¥
**æ–‡ä»¶**: `src/main/java/com/aicustomer/controller/CustomerController.java`

**å·²å®ç°çš„APIæ¥å£**:
- âœ… `GET /api/customer/{id}` - æ ¹æ®IDæŸ¥è¯¢å®¢æˆ·
- âœ… `GET /api/customer/code/{customerCode}` - æ ¹æ®å®¢æˆ·ç¼–å·æŸ¥è¯¢
- âœ… `GET /api/customer/list` - æŸ¥è¯¢å®¢æˆ·åˆ—è¡¨
- âœ… `GET /api/customer/page` - åˆ†é¡µæŸ¥è¯¢å®¢æˆ·
- âœ… `POST /api/customer` - ä¿å­˜å®¢æˆ·ï¼ˆæ–°å¢ï¼‰
- âœ… `PUT /api/customer` - æ›´æ–°å®¢æˆ·
- âœ… `DELETE /api/customer/{id}` - åˆ é™¤å®¢æˆ·ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
- âœ… `DELETE /api/customer/batch` - æ‰¹é‡åˆ é™¤å®¢æˆ·

**ç»“è®º**: Controllerå±‚å®ç°å®Œæ•´ï¼Œæ‰€æœ‰å¢åˆ æ”¹æŸ¥æ¥å£éƒ½å·²å®ç°ã€‚

### âœ… 2. Serviceå±‚æ£€æŸ¥
**æ–‡ä»¶**: `src/main/java/com/aicustomer/service/impl/CustomerServiceImpl.java`

**å·²å®ç°çš„æ–¹æ³•**:
- âœ… `getById()` - è°ƒç”¨ `customerMapper.selectById()`
- âœ… `getByCustomerCode()` - è°ƒç”¨ `customerMapper.selectByCustomerCode()`
- âœ… `list()` - è°ƒç”¨ `customerMapper.selectList()`
- âœ… `page()` - è°ƒç”¨ `customerMapper.selectPage()` å’Œ `selectCount()`
- âœ… `save()` - è°ƒç”¨ `customerMapper.insert()`ï¼Œä½¿ç”¨ `@Transactional`
- âœ… `update()` - è°ƒç”¨ `customerMapper.updateById()`ï¼Œä½¿ç”¨ `@Transactional`
- âœ… `deleteById()` - è°ƒç”¨ `customerMapper.deleteById()`ï¼Œä½¿ç”¨ `@Transactional`
- âœ… `deleteByIds()` - è°ƒç”¨ `customerMapper.deleteByIds()`ï¼Œä½¿ç”¨ `@Transactional`
- âœ… `existsByCustomerCode()` - è°ƒç”¨ `customerMapper.selectByCustomerCode()`

**ç»“è®º**: Serviceå±‚æ‰€æœ‰æ–¹æ³•éƒ½æ­£ç¡®è°ƒç”¨äº†Mapperï¼Œå®ç°äº†ä¸MySQLæ•°æ®åº“çš„äº¤äº’ã€‚

### âœ… 3. Mapperå±‚æ£€æŸ¥
**æ–‡ä»¶**: `src/main/resources/mapper/CustomerMapper.xml`

**å·²å®ç°çš„SQLæ˜ å°„**:
- âœ… `selectById` - SELECTæŸ¥è¯¢ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µæ˜ å°„
- âœ… `selectByCustomerCode` - SELECTæŸ¥è¯¢
- âœ… `selectList` - SELECTæŸ¥è¯¢ï¼Œæ”¯æŒåŠ¨æ€æ¡ä»¶
- âœ… `selectPage` - SELECTæŸ¥è¯¢ï¼Œæ”¯æŒåˆ†é¡µå’ŒåŠ¨æ€æ¡ä»¶
- âœ… `selectCount` - COUNTæŸ¥è¯¢ï¼Œæ”¯æŒåŠ¨æ€æ¡ä»¶
- âœ… `insert` - INSERTè¯­å¥ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µ
- âœ… `updateById` - UPDATEè¯­å¥ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°
- âœ… `deleteById` - UPDATEè¯­å¥ï¼ˆé€»è¾‘åˆ é™¤ï¼Œè®¾ç½®deleted=1ï¼‰
- âœ… `deleteByIds` - UPDATEè¯­å¥ï¼ˆæ‰¹é‡é€»è¾‘åˆ é™¤ï¼‰

**ç»“è®º**: Mapper XMLæ–‡ä»¶å®Œæ•´ï¼Œæ‰€æœ‰SQLè¯­å¥éƒ½æ­£ç¡®æ˜ å°„åˆ°æ•°æ®åº“æ“ä½œã€‚

### âœ… 4. æ•°æ®åº“é…ç½®æ£€æŸ¥
**æ–‡ä»¶**: `src/main/resources/application.yml`

**é…ç½®é¡¹**:
- âœ… æ•°æ®æºé…ç½®æ­£ç¡®ï¼šMySQL 8.0ï¼Œæ•°æ®åº“å `ai_customer_db`
- âœ… è¿æ¥æ± é…ç½®ï¼šHikariCP
- âœ… æ•°æ®åº“åˆå§‹åŒ–é…ç½®ï¼š`sql.init.mode=always`ï¼Œ`schema-locations: classpath:schema.sql`
- âœ… MyBatisé…ç½®ï¼šmapperä½ç½®ã€ç±»å‹åˆ«åç­‰

**ç»“è®º**: æ•°æ®åº“é…ç½®æ­£ç¡®ã€‚

## äºŒã€æ•°æ®åº“çŠ¶æ€

### âš ï¸ å½“å‰é—®é¢˜
- æ•°æ®åº“ `ai_customer_db` å·²å­˜åœ¨ï¼ˆé€šè¿‡ `createDatabaseIfNotExist=true` è‡ªåŠ¨åˆ›å»ºï¼‰
- ä½†è¡¨ç»“æ„æœªåˆå§‹åŒ–ï¼ˆ`customer` è¡¨ä¸å­˜åœ¨ï¼‰

### è§£å†³æ–¹æ¡ˆ
éœ€è¦æ‰‹åŠ¨åˆå§‹åŒ–è¡¨ç»“æ„ã€‚æœ‰ä¸¤ç§æ–¹å¼ï¼š

#### æ–¹å¼1ï¼šä½¿ç”¨MySQLå‘½ä»¤è¡Œï¼ˆæ¨èï¼‰
```bash
mysql -uroot -p12345678 ai_customer_db < src/main/resources/schema.sql
```

#### æ–¹å¼2ï¼šä½¿ç”¨æä¾›çš„åˆå§‹åŒ–è„šæœ¬
```bash
./init_database.sh
```

#### æ–¹å¼3ï¼šé‡å¯åº”ç”¨ï¼ˆå¦‚æœSpring Bootè‡ªåŠ¨åˆå§‹åŒ–ç”Ÿæ•ˆï¼‰
é‡å¯åº”ç”¨åï¼ŒSpring Bootåº”è¯¥ä¼šè‡ªåŠ¨æ‰§è¡Œ `schema.sql` åˆå§‹åŒ–è¡¨ç»“æ„ã€‚

## ä¸‰ã€æµ‹è¯•æ•°æ®

### æµ‹è¯•å®¢æˆ·æ•°æ®
```json
{
  "customerName": "æµ‹è¯•å®¢æˆ·å…¬å¸",
  "customerType": 2,
  "phone": "13800138000",
  "email": "test@example.com",
  "address": "æµ‹è¯•åœ°å€123å·",
  "customerLevel": 2,
  "status": 1,
  "source": 1,
  "remark": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®ï¼Œç”¨äºéªŒè¯å¢åˆ æ”¹æŸ¥åŠŸèƒ½"
}
```

## å››ã€æµ‹è¯•æ­¥éª¤

### 1. åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„
```bash
# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
./init_database.sh

# æˆ–æ‰‹åŠ¨æ‰§è¡Œ
mysql -uroot -p12345678 ai_customer_db < src/main/resources/schema.sql
```

### 2. è¿è¡Œæµ‹è¯•è„šæœ¬
```bash
# æ‰§è¡Œå®Œæ•´çš„å¢åˆ æ”¹æŸ¥æµ‹è¯•
./test_customer_crud.sh
```

### 3. æ‰‹åŠ¨æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

#### 3.1 æ–°å¢å®¢æˆ·
```bash
curl -X POST "http://localhost:8080/api/customer" \
  -H "Content-Type: application/json" \
  -d '{
    "customerName": "æµ‹è¯•å®¢æˆ·å…¬å¸",
    "customerType": 2,
    "phone": "13800138000",
    "email": "test@example.com",
    "address": "æµ‹è¯•åœ°å€123å·",
    "customerLevel": 2,
    "status": 1,
    "source": 1,
    "remark": "è¿™æ˜¯ä¸€æ¡æµ‹è¯•æ•°æ®"
  }'
```

#### 3.2 æŸ¥è¯¢å®¢æˆ·ï¼ˆåˆ†é¡µï¼‰
```bash
curl "http://localhost:8080/api/customer/page?pageNum=1&pageSize=10"
```

#### 3.3 æ ¹æ®IDæŸ¥è¯¢
```bash
curl "http://localhost:8080/api/customer/1"
```

#### 3.4 æ›´æ–°å®¢æˆ·
```bash
curl -X PUT "http://localhost:8080/api/customer" \
  -H "Content-Type: application/json" \
  -d '{
    "id": 1,
    "customerName": "æ›´æ–°åçš„æµ‹è¯•å®¢æˆ·å…¬å¸",
    "phone": "13900139000"
  }'
```

#### 3.5 åˆ é™¤å®¢æˆ·
```bash
curl -X DELETE "http://localhost:8080/api/customer/1"
```

## äº”ã€ä»£ç è´¨é‡è¯„ä¼°

### âœ… ä¼˜ç‚¹
1. **å®Œæ•´çš„CRUDæ“ä½œ**: æ‰€æœ‰å¢åˆ æ”¹æŸ¥åŠŸèƒ½éƒ½å·²å®ç°
2. **äº‹åŠ¡æ”¯æŒ**: ä½¿ç”¨ `@Transactional` ä¿è¯æ•°æ®ä¸€è‡´æ€§
3. **é€»è¾‘åˆ é™¤**: ä½¿ç”¨ `deleted` å­—æ®µï¼Œä¸ç‰©ç†åˆ é™¤æ•°æ®
4. **æ•°æ®éªŒè¯**: Controllerå±‚æœ‰å¿…å¡«å­—æ®µéªŒè¯
5. **é”™è¯¯å¤„ç†**: æœ‰å¼‚å¸¸æ•è·å’Œé”™è¯¯ä¿¡æ¯è¿”å›
6. **åŠ¨æ€SQL**: Mapperæ”¯æŒåŠ¨æ€æŸ¥è¯¢æ¡ä»¶
7. **æ•°æ®è„±æ•**: æŸ¥è¯¢ç»“æœè‡ªåŠ¨è¿›è¡Œæ•æ„Ÿæ•°æ®è„±æ•

### âš ï¸ æ³¨æ„äº‹é¡¹
1. **æ•°æ®åº“åˆå§‹åŒ–**: éœ€è¦ç¡®ä¿è¡¨ç»“æ„å·²åˆå§‹åŒ–
2. **å®¢æˆ·ç¼–å·å”¯ä¸€æ€§**: ä¿å­˜å‰ä¼šæ£€æŸ¥å®¢æˆ·ç¼–å·æ˜¯å¦å·²å­˜åœ¨
3. **é»˜è®¤å€¼è®¾ç½®**: è‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼ï¼ˆcustomerType=1, status=1, source=2, customerLevel=1ï¼‰

## å…­ã€æ€»ç»“

### âœ… ä»£ç å®ç°çŠ¶æ€
- **Controllerå±‚**: âœ… å®Œæ•´å®ç°
- **Serviceå±‚**: âœ… å®Œæ•´å®ç°ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½è°ƒç”¨Mapper
- **Mapperå±‚**: âœ… å®Œæ•´å®ç°ï¼ŒSQLæ˜ å°„æ­£ç¡®
- **æ•°æ®åº“é…ç½®**: âœ… é…ç½®æ­£ç¡®

### âš ï¸ å¾…å®Œæˆäº‹é¡¹
1. **åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„** - éœ€è¦æ‰§è¡Œ `schema.sql` åˆ›å»ºè¡¨
2. **æ‰§è¡Œæµ‹è¯•** - åˆå§‹åŒ–å®Œæˆåè¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½

### ğŸ“ ç»“è®º
**å®¢æˆ·æ¡£æ¡ˆç®¡ç†çš„å¢åˆ æ”¹æŸ¥åŠŸèƒ½ä»£ç å®ç°å®Œæ•´ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½æ­£ç¡®å®ç°äº†ä¸MySQLæ•°æ®åº“çš„äº¤äº’ã€‚åªéœ€è¦åˆå§‹åŒ–æ•°æ®åº“è¡¨ç»“æ„ï¼Œå³å¯è¿›è¡Œå®Œæ•´çš„åŠŸèƒ½æµ‹è¯•ã€‚**

