# 功能业务约束文档

## 文档说明

本文档定义了AI客户管理系统项目的功能模块约束、业务规则约束和数据字段约束。所有功能开发必须严格遵循本文档定义的业务规则和数据规范。

**文档版本**: 1.0.0  
**创建日期**: 2025-11-01  
**最后更新**: 2025-11-01  
**维护者**: AI客户管理系统产品团队

---

## 系统功能概述

### 核心价值

**AI客户管理系统**是一个基于人工智能技术的现代化客户关系管理平台，专为企业提供智能化、自动化的客户管理解决方案。系统集成了客户档案管理、沟通记录、AI智能分析、团队协作等核心功能，帮助企业提升客户服务质量，优化业务流程，实现数字化转型。

### 解决的核心问题
- **客户信息分散** - 统一管理所有客户数据
- **沟通记录丢失** - 完整记录客户沟通历史
- **客户分析困难** - AI智能分析客户行为和价值
- **团队协作低效** - 提升团队协作效率
- **决策缺乏数据支持** - 提供数据驱动的决策依据

### 带来的价值
- **提升客户满意度** - 更好的客户服务和体验
- **增加销售转化率** - 精准的客户分析和跟进
- **降低运营成本** - 自动化流程减少人工成本
- **提高团队效率** - 协作工具提升工作效率
- **数据驱动决策** - 基于数据的科学决策

---

## 功能模块约束

### 1. 客户档案管理

#### 功能边界
全面管理客户基本信息、详细资料、标签分类等，建立完整的客户档案体系。

#### 主要功能
- **客户基本信息管理**
  - 个人客户：姓名、联系方式、身份证等
  - 企业客户：公司名称、组织机构代码、法人信息等
  - 植物新品种保护申请相关字段：申请人性质、代理机构信息等

- **客户详细信息**
  - 行业分类、业务类型、重要程度评估
  - 客户价值评分、生命周期阶段分析
  - 累计消费金额、合作次数统计
  - 信用评估等级、满意度评分

- **客户标签管理**
  - 系统标签：VIP客户、普通客户、流失客户
  - 自定义标签：行业标签、业务标签
  - AI标签：基于行为分析的智能标签

#### 业务规则约束
- 客户编号必须唯一，系统自动生成或手动指定
- 客户类型：1=个人，2=企业，3=科研院所，4=其他
- 客户等级：1=普通，2=VIP，3=钻石
- 客户状态：1=正常，2=冻结，3=注销
- 客户来源：1=线上，2=线下，3=推荐
- 禁止删除有关联沟通记录或任务的客户（必须先清理关联数据）

#### 数据字段约束

**客户基本信息表 (customer)**

| 字段名 | 类型 | 必填 | 说明 | 业务规则 |
|--------|------|------|------|----------|
| id | BIGINT | 是 | 主键ID | 自增 |
| customer_code | VARCHAR(50) | 是 | 客户编号 | 唯一，不可修改 |
| customer_name | VARCHAR(100) | 是 | 客户姓名 | 个人填写姓名，企业填写公司名称 |
| customer_type | TINYINT | 是 | 客户类型 | 1:个人,2:企业,3:科研院所,4:其他 |
| phone | VARCHAR(20) | 否 | 手机号码 | 格式验证 |
| email | VARCHAR(100) | 否 | 邮箱 | 格式验证 |
| address | VARCHAR(500) | 否 | 地址 | |
| customer_level | TINYINT | 是 | 客户等级 | 1:普通,2:VIP,3:钻石，默认1 |
| status | TINYINT | 是 | 客户状态 | 1:正常,2:冻结,3:注销，默认1 |
| source | TINYINT | 是 | 客户来源 | 1:线上,2:线下,3:推荐，默认2 |

**植物新品种保护申请相关字段**

| 字段名 | 类型 | 必填 | 说明 | 业务规则 |
|--------|------|------|------|----------|
| contact_person | VARCHAR(100) | 否 | 联系人 | |
| postal_code | VARCHAR(10) | 否 | 邮政编码 | 6位数字格式 |
| fax | VARCHAR(20) | 否 | 传真 | |
| organization_code | VARCHAR(50) | 否 | 机构代码或身份证号码 | 企业填写机构代码，个人填写身份证 |
| nationality | VARCHAR(50) | 否 | 国籍或所在国（地区） | |
| applicant_nature | TINYINT | 否 | 申请人性质 | 1:个人,2:企业,3:科研院所,4:其他 |
| agency_name | VARCHAR(200) | 否 | 代理机构名称 | |
| agency_code | VARCHAR(50) | 否 | 代理机构组织机构代码 | |
| agency_address | VARCHAR(500) | 否 | 代理机构地址 | |
| agency_postal_code | VARCHAR(10) | 否 | 代理机构邮政编码 | |
| agent_name | VARCHAR(100) | 否 | 代理人姓名 | |
| agent_phone | VARCHAR(20) | 否 | 代理人电话 | |
| agent_fax | VARCHAR(20) | 否 | 代理人传真 | |
| agent_mobile | VARCHAR(20) | 否 | 代理人手机 | |
| agent_email | VARCHAR(100) | 否 | 代理人邮箱 | 格式验证 |

**客户详细信息表 (customer_detail)**

| 字段名 | 类型 | 必填 | 说明 | 业务规则 |
|--------|------|------|------|----------|
| id | BIGINT | 是 | 主键ID | 自增 |
| customer_id | BIGINT | 是 | 客户ID | 外键关联customer表 |
| industry_category | VARCHAR(100) | 否 | 行业分类 | |
| business_type | VARCHAR(100) | 否 | 业务类型 | |
| importance_level | TINYINT | 否 | 重要程度 | 1-5级，数字越大越重要 |
| value_score | DECIMAL(5,2) | 否 | 价值评分 | 0-100分，AI计算或手动评分 |
| lifecycle_stage | VARCHAR(50) | 否 | 生命周期阶段 | 潜在/新客户/活跃/流失 |
| total_consumption | DECIMAL(15,2) | 否 | 累计消费金额 | 自动累计 |
| cooperation_count | INT | 否 | 合作次数 | 自动累计 |
| credit_rating | VARCHAR(50) | 否 | 信用评估等级 | |
| satisfaction_score | DECIMAL(3,2) | 否 | 满意度评分 | 0-5分 |

**客户标签表 (customer_tag)**

| 字段名 | 类型 | 必填 | 说明 | 业务规则 |
|--------|------|------|------|----------|
| id | BIGINT | 是 | 主键ID | 自增 |
| customer_id | BIGINT | 是 | 客户ID | 外键关联customer表 |
| tag_name | VARCHAR(50) | 是 | 标签名称 | |
| tag_type | TINYINT | 是 | 标签类型 | 1:系统标签,2:自定义标签,3:AI标签 |
| tag_color | VARCHAR(20) | 否 | 标签颜色 | 用于界面展示 |
| description | VARCHAR(500) | 否 | 标签描述 | |

#### 功能扩展约束
- **允许扩展**：
  - 增加新的客户类型分类
  - 增加新的客户等级
  - 增加新的标签类型
  - 扩展客户详细信息字段（需同步更新customer_detail表）

- **禁止扩展**：
  - 禁止修改客户编号生成规则（必须保持唯一性）
  - 禁止删除已有的客户状态枚举值
  - 禁止修改客户基本信息表的核心字段结构

---

### 2. 沟通记录管理

#### 功能边界
记录和管理与客户的所有沟通历史，包括微信、电话、邮件、会面等多种沟通方式。

#### 主要功能
- **多渠道沟通记录**
  - 微信聊天记录
  - 电话沟通记录
  - 邮件往来记录
  - 会面记录
  - 其他沟通方式

- **智能内容分析**
  - 沟通内容摘要生成
  - 情感分析（积极/中性/消极）
  - 关键词提取
  - 重要信息标记

- **满意度评估**
  - 客户满意度评分（1-5分）
  - 沟通效果评估
  - 客户响应时间统计

- **任务跟进管理**
  - 后续任务创建
  - 任务截止时间设置
  - 任务状态跟踪
  - 任务完成结果记录

#### 业务规则约束
- 沟通记录必须关联到具体客户
- 沟通方式：1=微信，2=电话，3=邮件，4=会面，5=其他
- 情感分析结果：1=积极，2=中性，3=消极
- 满意度评分：1-5分，5分为最高
- 沟通记录创建后不可删除，只能标记为无效

#### 数据字段约束

**沟通记录表 (communication_record)**

| 字段名 | 类型 | 必填 | 说明 | 业务规则 |
|--------|------|------|------|----------|
| id | BIGINT | 是 | 主键ID | 自增 |
| customer_id | BIGINT | 是 | 客户ID | 外键关联customer表 |
| communication_type | TINYINT | 是 | 沟通方式 | 1:微信,2:电话,3:邮件,4:会面,5:其他 |
| content | TEXT | 是 | 沟通内容 | 必填 |
| summary | VARCHAR(500) | 否 | 内容摘要 | AI自动生成 |
| emotion | TINYINT | 否 | 情感分析 | 1:积极,2:中性,3:消极 |
| keywords | VARCHAR(500) | 否 | 关键词 | AI提取，逗号分隔 |
| satisfaction_score | TINYINT | 否 | 满意度评分 | 1-5分 |
| communication_time | DATETIME | 是 | 沟通时间 | 默认当前时间 |
| next_follow_time | DATETIME | 否 | 下次跟进时间 | |

---

### 3. AI智能分析

#### 功能边界
基于人工智能技术，对客户数据、沟通记录、业务指标进行深度分析，提供数据洞察。

#### 主要功能
- **客户行为分析**
  - 客户访问模式分析
  - 购买行为预测
  - 客户流失风险预警
  - 客户价值趋势分析

- **沟通效果分析**
  - 沟通频率分析
  - 沟通效果评估
  - 最佳沟通时间推荐
  - 沟通内容优化建议

- **业务指标分析**
  - 销售业绩分析
  - 客户满意度趋势
  - 团队工作效率分析
  - 业务增长预测

- **数据可视化**
  - 交互式图表展示
  - 实时数据监控
  - 自定义报表生成
  - 数据导出功能

#### 业务规则约束
- AI分析结果仅供参考，不作为唯一决策依据
- 流失风险预警阈值可配置
- 分析结果实时更新，缓存时间不超过1小时
- 分析数据来源必须经过数据脱敏处理

---

### 4. AI智能推荐

#### 功能边界
基于客户数据和AI算法，为销售和服务人员提供个性化的推荐建议。

#### 主要功能
- **客户推荐**
  - 潜在客户推荐
  - 高价值客户识别
  - 客户需求预测
  - 最佳客户匹配

- **产品推荐**
  - 个性化产品推荐
  - 交叉销售建议
  - 升级销售机会
  - 产品组合优化

- **服务推荐**
  - 个性化服务建议
  - 最佳服务时间推荐
  - 服务方式优化
  - 客户关怀提醒

- **策略推荐**
  - 销售策略建议
  - 沟通策略优化
  - 跟进频率建议
  - 风险控制建议

#### 业务规则约束
- 推荐算法必须可解释
- 推荐结果必须标记置信度
- 用户可以拒绝或接受推荐
- 推荐历史需要记录用于算法优化

---

### 5. AI智能聊天

#### 功能边界
提供智能客服机器人，24小时在线服务，自动回答客户问题，提升客户体验。

#### 主要功能
- **智能问答**
  - 常见问题自动回答
  - 产品信息查询
  - 服务流程指导
  - 问题分类处理

- **多轮对话**
  - 上下文理解
  - 对话历史记录
  - 意图识别
  - 情感分析

- **人工转接**
  - 复杂问题转人工
  - 客户情绪异常转接
  - 专业问题转专家
  - 投诉问题转处理

- **学习优化**
  - 对话数据学习
  - 回答准确率提升
  - 新问题自动学习
  - 服务质量持续改进

#### 业务规则约束
- 转人工规则必须明确且可配置
- 对话记录必须完整保存
- 敏感信息必须脱敏处理
- 回答准确率低于80%的问题必须转人工

---

### 6. 团队协作

#### 功能边界
提供团队任务管理、成员协作、权限控制等功能，提升团队工作效率。

#### 主要功能
- **任务管理**
  - 任务创建和分配
  - 任务进度跟踪
  - 任务优先级设置
  - 任务完成情况统计

- **团队管理**
  - 团队成员信息管理
  - 部门组织架构
  - 角色权限分配
  - 团队绩效统计

- **协作工具**
  - 任务评论和讨论
  - 文件共享
  - 实时消息通知
  - 工作流程管理

- **权限控制**
  - 基于角色的权限管理
  - 数据访问控制
  - 操作权限限制
  - 审计日志记录

#### 业务规则约束
- 任务必须关联到具体客户或业务
- 任务优先级：1=低，2=中，3=高，4=紧急
- 任务状态：1=待分配，2=进行中，3=已完成，4=已取消
- 权限变更必须记录审计日志

#### 数据字段约束

**团队任务表 (team_task)**

| 字段名 | 类型 | 必填 | 说明 | 业务规则 |
|--------|------|------|------|----------|
| id | BIGINT | 是 | 主键ID | 自增 |
| task_name | VARCHAR(200) | 是 | 任务名称 | |
| customer_id | BIGINT | 否 | 关联客户ID | 外键关联customer表 |
| assignee_id | BIGINT | 是 | 负责人ID | 外键关联sys_user表 |
| priority | TINYINT | 是 | 优先级 | 1:低,2:中,3:高,4:紧急 |
| status | TINYINT | 是 | 任务状态 | 1:待分配,2:进行中,3:已完成,4:已取消 |
| due_date | DATETIME | 否 | 截止时间 | |
| progress | INT | 是 | 完成进度 | 0-100，默认0 |

---

### 7. 消息中心

#### 功能边界
集中管理所有系统消息、通知提醒、快速操作入口，提供一站式消息处理中心。

#### 主要功能
- **系统通知管理**
  - 任务提醒通知
  - 客户生日提醒
  - 合同到期提醒
  - 系统更新通知

- **快速操作入口**
  - 新增客户
  - 添加沟通记录
  - 创建任务
  - 生成报告

- **最近活动展示**
  - 最近客户访问
  - 最近沟通记录
  - 最近任务完成
  - 最近系统操作

- **消息分类管理**
  - 未读消息提醒
  - 重要消息标记
  - 消息分类筛选
  - 消息批量处理

#### 业务规则约束
- 消息类型：1=系统通知，2=业务提醒，3=任务通知，4=客户消息
- 消息重要性：1=普通，2=重要，3=紧急
- 未读消息超过100条时触发清理提醒
- 消息保留期限：普通消息30天，重要消息90天

---

## 功能展示规范

### UI设计原则

#### 1. 设计风格
- **科技感配色**：深色侧边栏 + 渐变色彩搭配
- **卡片式布局**：信息展示更加直观
- **响应式设计**：完美适配各种设备屏幕
- **交互体验**：流畅的动画效果和用户反馈

#### 2. 颜色方案

**主色调**
- 主渐变: `linear-gradient(135deg, #667eea 0%, #764ba2 100%)`
- 背景色: `#f8fafc`
- 文字色: `#2d3748`, `#4a5568`

**功能模块颜色**
- 客户管理: `#10b981` (绿色)
- 沟通记录: `#3b82f6` (蓝色)
- AI智能: `#8b5cf6` (紫色)
- 团队协作: `#f59e0b` (橙色)
- 消息中心: `#ef4444` (红色)
- 数据报表: `#06b6d4` (青色)
- 系统设置: `#6b7280` (灰色)

#### 3. 布局规范
- 使用CSS Grid和Flexbox布局
- 容器最大宽度：1400px
- 卡片圆角：15-20px
- 间距统一：使用8px的倍数（8px, 16px, 24px, 32px, 40px）

#### 4. 交互规范
- 所有可点击元素必须有悬停效果
- 按钮点击必须有视觉反馈
- 数据加载必须显示加载状态
- 操作成功/失败必须有明确提示

#### 5. HTML文件结构规范
**严格约束：**
- **禁止内联JavaScript和CSS**：所有JavaScript和CSS代码必须提取到独立的外部文件中
- **文件行数限制**：单个HTML文件不得超过1500行
- **文件拆分规则**：超过1500行的HTML文件必须按功能和模块拆分
  - 按功能模块拆分：如将客户列表、客户详情、客户编辑拆分为不同文件
  - 按组件拆分：将独立的模态框、表单等组件拆分为独立文件
  - 使用JavaScript动态加载：通过JS动态加载拆分后的HTML片段
- **文件命名规范**：
  - HTML主文件：`[功能名].html`（如：customers.html）
  - HTML组件文件：`[功能名]-[组件名].html`（如：customers-form.html, customers-detail.html）
  - JavaScript文件：`js/[功能名].js`（如：js/customers.js）
  - CSS文件：`css/[功能名].css`（如：css/customers.css）
- **引用规范**：
  - HTML中通过`<script src="/js/[文件名].js"></script>`引用JavaScript
  - HTML中通过`<link href="/css/[文件名].css" rel="stylesheet">`引用CSS
- **模块化原则**：
  - 每个功能模块的JavaScript应该独立成文件
  - 公共函数提取到公共JS文件（如：common.js, api.js）
  - 公共样式提取到公共CSS文件（如：common.css）
- **拆分示例**：
  ```
  customers.html (主文件，<500行)
  ├── customers-list.html (客户列表组件，<500行)
  ├── customers-form.html (客户表单组件，<400行)
  ├── customers-detail.html (客户详情组件，<400行)
  ├── js/customers.js (客户管理JS，<1000行)
  ├── js/customers-api.js (客户API调用，<300行)
  └── css/customers.css (客户管理样式，<500行)
  ```

### 功能导图展示

#### 功能模块导图结构
```
AI客户管理系统
├── 客户管理
│   ├── 客户档案
│   │   ├── 基本信息管理
│   │   ├── 详细资料维护
│   │   ├── 客户标签分类
│   │   └── 客户状态跟踪
│   └── 客户分析
│       ├── 行为分析
│       ├── 价值评估
│       ├── 风险预警
│       └── 生命周期管理
├── 沟通记录
│   ├── 沟通历史
│   └── 沟通分析
├── AI智能功能
│   ├── AI智能分析
│   ├── AI智能推荐
│   └── AI智能聊天
├── 团队协作
│   ├── 团队管理
│   └── 任务协作
├── 消息中心
│   ├── 消息管理
│   └── 消息分析
├── 数据报表
│   ├── 业务报表
│   └── 数据分析
└── 系统设置
    ├── 基础设置
    └── 数据管理
```

---

## 数据字段业务约束

### 通用字段约束

#### 基础字段
所有业务表必须包含以下基础字段：
- `id` - 主键，自增，不可修改
- `create_time` - 创建时间，系统自动设置
- `update_time` - 更新时间，系统自动更新
- `create_by` - 创建人，记录创建者ID
- `update_by` - 更新人，记录最后更新者ID
- `deleted` - 删除标志，0=未删除，1=已删除（逻辑删除）
- `version` - 版本号，用于乐观锁控制

#### 状态字段约束
- 所有状态字段必须使用TINYINT类型
- 状态值必须从1开始连续编号
- 状态值必须明确定义，禁止使用0或负数
- 状态变更必须记录日志

### 数据验证规则

#### 必填字段验证
- 带"必填"标记的字段创建时必须验证
- 更新时允许不提供未修改的必填字段
- 批量导入时必填字段缺失必须拒绝并提示

#### 格式验证
- **手机号码**：11位数字，1开头
- **邮箱**：符合RFC 5322标准格式
- **身份证**：18位，最后一位可以是X
- **邮政编码**：6位数字
- **日期时间**：YYYY-MM-DD HH:mm:ss格式

#### 数值范围验证
- **评分字段**：必须在定义范围内（如1-5分）
- **百分比字段**：0-100
- **金额字段**：必须大于等于0
- **数量字段**：必须大于等于0的整数

### 数据关联约束

#### 外键关联规则
- 所有外键字段必须关联到存在的记录
- 删除主表记录前必须检查是否有外键关联
- 外键字段允许NULL，但一旦设置值必须有效

#### 数据一致性约束
- 客户信息与客户详情必须一致（customer_id关联）
- 沟通记录必须关联到有效客户
- 任务必须关联到有效负责人或客户

---

## 功能扩展约束

### 允许的功能扩展
- 增加新的客户类型分类（需同步更新枚举值）
- 增加新的沟通方式类型
- 增加新的任务优先级级别
- 扩展客户详细信息字段（需同步更新customer_detail表）
- 增加新的分析维度（不影响现有数据）

### 禁止的功能扩展
- **禁止删除**已有的枚举值（客户类型、状态、来源等）
- **禁止修改**客户编号生成规则（必须保持唯一性）
- **禁止删除**客户基本信息表的核心字段
- **禁止修改**数据表的主键结构
- **禁止删除**已有的功能模块（可标记为废弃，但需保留数据）

### 功能废弃流程
1. 标记功能为"已废弃"
2. 在界面上隐藏废弃功能入口
3. 保留后端API和数据表结构
4. 记录废弃原因和时间
5. 通知所有用户功能变更

---

## 业务规则总结

### 核心业务规则
1. **客户编号唯一性**：系统必须保证客户编号全局唯一
2. **数据关联完整性**：删除数据前必须检查关联关系
3. **逻辑删除优先**：优先使用逻辑删除，保留数据历史
4. **审计日志**：关键操作必须记录审计日志
5. **权限控制**：数据访问必须基于角色权限控制

### 数据安全规则
1. **敏感信息脱敏**：手机、身份证、邮箱等敏感信息显示时必须脱敏
2. **数据加密存储**：密码等敏感数据必须加密存储
3. **访问权限验证**：每次数据访问必须验证用户权限
4. **操作审计**：所有数据修改操作必须记录审计日志

---

## 功能开发规范

### 功能开发流程
1. **需求确认**：明确功能边界和业务规则
2. **数据设计**：设计数据表结构和字段约束
3. **接口设计**：设计RESTful API接口
4. **前端开发**：遵循UI设计规范和交互规范
5. **测试验证**：功能测试和业务规则验证
6. **文档更新**：更新功能约束文档

### 代码实现约束
- 所有业务规则必须在Service层实现
- 数据验证必须在Controller层和Service层双重验证
- 异常处理必须统一，返回友好的错误提示
- 日志记录必须完整，包含关键操作信息

---

## 重要提醒

1. **本文档是功能开发的唯一业务规范依据**
2. **任何功能变更必须先更新本文档**
3. **数据字段变更必须同步更新数据库设计和实体类**
4. **新增功能必须明确功能边界和业务规则**
5. **定期审查功能使用情况，优化业务规则**

---

**本约束文档具有最高优先级，所有开发人员必须严格遵守！**

